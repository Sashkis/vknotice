"use strict";function Dialog(a){var b="https://vk.com/";$.extend(this,a),this.isGroup=void 0!==this.chat_id,this.isGroup?(this.id=this.chat_id,this.url=b+"im?sel=c"+this.id):(this.id=this.user_id,this.url=b+"im?sel="+this.id),$.isEmptyObject(a.messages)&&(delete a.messages,this.messages=[],this.messages.push(a)),this.messages.sort(function(a,b){return a.date-b.date})}function getCase(a,b){return 0!=a?a+"&nbsp"+b[a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2]:""}function Message(a,b){if(this.id=a.id,1===a.out?this.user_id=Popup.current.id:this.user_id=a.user_id,b&&(this.url=b+"&msgid="+this.id),a.action?this.body=[$("<span/>",{"class":"system",html:Popup.loc(a.action)+" "})]:a.body?(a.body=a.body.escapeHtml(),1===a.emoji&&(a.body=window.Emoji.emojiToHTML(a.body)),this.body=[$("<span/>",{html:a.body+" "}).linkify({format:function(a,b){return"url"===b&&a.length>36&&(a=a.substr(0,35)+"…"),a}})]):this.body=[],a.geo&&(void 0===a.attachments&&(a.attachments=[]),a.attachments.push({type:"geo",geo:a.geo}),delete a.geo),a.attachments){var c=this;a.attachments=a.attachments.map(function(a){var b="https://vk.com/",d=a.type,a=a[d];switch(d){case"photo":return a.url="",a.photo_2560?a.url=a.photo_2560:a.photo_1280?a.url=a.photo_1280:a.photo_807?a.url=a.photo_807:a.photo_604?a.url=a.photo_604:a.photo_130?a.url=a.photo_130:a.photo_75&&(a.url=a.photo_75),$("<a/>",{href:a.url,target:"_blank",html:[$("<i/>",{"class":"icon-camera"}),Popup.loc("Photo")]});case"gift":return a.url="",a.thumb_256?a.url=a.thumb_256:a.thumb_96?a.url=a.thumb_96:a.thumb_48&&(a.url=a.thumb_48),$("<a/>",{href:a.url,target:"_blank",html:[$("<i/>",{"class":"icon-gift"}),Popup.loc("Gift")]});case"wall":return $("<a/>",{href:b+"wall"+a.from_id+"_"+a.id,target:"_blank",html:[$("<i/>",{"class":"icon-pencil"}),Popup.loc("Post")]});case"wall_reply":return $("<a/>",{href:b+"wall"+a.owner_id+"_"+a.post_id+"?reply="+a.id,target:"_blank",html:[$("<i/>",{"class":"icon-chat"}),Popup.loc("Comment")]});case"audio":return $("<a/>",{href:b+"audio"+a.owner_id+"_"+a.id,target:"_blank",html:[$("<i/>",{"class":"icon-music"}),a.artist.bold()+"&nbsp;–&nbsp;"+a.title]});case"video":return $("<a/>",{href:b+"video"+a.owner_id+"_"+a.id,target:"_blank",html:[$("<i/>",{"class":"icon-video"}),a.title]});case"doc":return $("<a/>",{href:a.url,target:"_blank",html:[$("<i/>",{"class":"icon-doc"}),a.title]});case"link":return $("<a/>",{href:a.url,target:"_blank",html:[$("<i/>",{"class":"icon-link"}),a.title]});case"geo":return a.coordinates=a.coordinates.split(" "),a.coordinates=a.coordinates[0]-0+","+(a.coordinates[1]-0),$("<a/>",{href:"https://www.google.com.ua/maps/place/@"+a.coordinates+",13z/data=!3m1!4b1!4m2!3m1!1s0x0:0x0",target:"_blank",html:[$("<i/>",{"class":"icon-location"}),a.place?a.place.title:window.Popup.loc("Map")]});case"sticker":return $("<img/>",{"class":"emoji sticker",src:a.photo_64,height:"32"});default:return $("<a/>",{href:c.url,target:"_blank",html:[$("<i/>",{"class":"icon-attach"}),Popup.loc("Attachment"),,]})}}),this.body=this.body.concat(a.attachments)}if(a.fwd_messages){var d=0;$.isArray(a.fwd_messages)?d=a.fwd_messages.length:$.isNumeric(a.fwd_messages)&&(d=a.fwd_messages-0),this.body.push($("<a/>",{href:this.url,target:"_blank",html:[$("<i/>",{"class":"icon-chat"}),getCase(d,Popup.loc("forwarded messages"))]}))}}function User(a){$.extend(this,a),this.name=this.first_name+" "+this.last_name}if(function(){function a(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b,c,d){for(var e=0,f=a.length,g=[],h=void 0;f>e&&(h=b.next(a[e]));)b=h,e++;if(e>=f)return[];for(;f-1>e;)h=new n(d),g.push(h),b.on(a[e],h),b=h,e++;return h=new n(c),g.push(h),b.on(a[f-1],h),g}function d(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){return a instanceof r||a instanceof F}function g(a){return a}function h(a,b){return"url"===b?"_blank":null}function i(a){return a=a||{},{attributes:a.linkAttributes||null,defaultProtocol:a.defaultProtocol||"http",events:a.events||null,format:a.format||g,formatHref:a.formatHref||g,newLine:a.newLine||!1,nl2br:!!a.newLine||a.nl2br||!1,tagName:a.tagName||"a",target:a.target||h,linkClass:a.linkClass||"linkified"}}function j(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return"function"==typeof a?a.apply(void 0,c):a}function k(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}var l={__esModule:!0},m=function(){function a(c){b(this,a),this.j=[],this.T=c||null}return a.prototype.on=function(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)this.j.push([a[c],b]);else this.j.push([a,b])},a.prototype.next=function(a){for(var b=0;b<this.j.length;b++){var c=this.j[b],d=c[1];if(this.test(a,c[0]))return d}return!1},a.prototype.accepts=function(){return!!this.T},a.prototype.test=function(a,b){return a===b},a.prototype.emit=function(){return this.T},a}(),n=function(c){function d(){b(this,d),c.apply(this,arguments)}return a(d,c),d.prototype.test=function(a,b){return a===b||b instanceof RegExp&&b.test(a)},d}(m),o=function(c){function d(){b(this,d),c.apply(this,arguments)}return a(d,c),d.prototype.test=function(a,b){return a instanceof b},d}(m);l.CharacterState=n,l.TokenState=o,l.stateify=c;var p={__esModule:!0},q=function(){function a(b){e(this,a),this.v=b}return a.prototype.toString=function(){return this.v+""},a}(),r=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),s=function(a){function b(){e(this,b),a.call(this,"@")}return d(b,a),b}(q),t=function(a){function b(){e(this,b),a.call(this,":")}return d(b,a),b}(q),u=function(a){function b(){e(this,b),a.call(this,".")}return d(b,a),b}(q),v=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),w=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),x=function(a){function b(){e(this,b),a.call(this,"\n")}return d(b,a),b}(q),y=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),z=function(a){function b(){e(this,b),a.call(this,"+")}return d(b,a),b}(q),A=function(a){function b(){e(this,b),a.call(this,"#")}return d(b,a),b}(q),B=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),C=function(a){function b(){e(this,b),a.call(this,"?")}return d(b,a),b}(q),D=function(a){function b(){e(this,b),a.call(this,"/")}return d(b,a),b}(q),E=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),F=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),G=function(a){function b(){e(this,b),a.apply(this,arguments)}return d(b,a),b}(q),H={Base:q,DOMAIN:r,AT:s,COLON:t,DOT:u,PUNCTUATION:v,LOCALHOST:w,NL:x,NUM:y,PLUS:z,POUND:A,QUERY:C,PROTOCOL:B,SLASH:D,SYM:E,TLD:F,WS:G},I=function(){function a(b){e(this,a),this.v=b,this.type="token",this.isLink=!1}return a.prototype.toString=function(){for(var a=[],b=0;b<this.v.length;b++)a.push(this.v[b].toString());return a.join("")},a.prototype.toHref=function(){return this.toString()},a.prototype.toObject=function(){return{type:this.type,value:this.toString(),href:this.toHref(0>=arguments.length||void 0===arguments[0]?"http":arguments[0])}},a}(),J=function(a){function b(c){e(this,b),a.call(this,c),this.type="email",this.isLink=!0}return d(b,a),b.prototype.toHref=function(){return"mailto:"+this.toString()},b}(I),K=function(a){function b(c){e(this,b),a.call(this,c),this.type="text"}return d(b,a),b}(I),L=function(a){function b(c){e(this,b),a.call(this,c),this.type="nl"}return d(b,a),b}(I),M=function(a){function b(c){e(this,b),a.call(this,c),this.type="url",this.isLink=!0}return d(b,a),b.prototype.toHref=function(){for(var a=0>=arguments.length||void 0===arguments[0]?"http":arguments[0],b=!1,c=!1,d=this.v,e=[],g=0;d[g]instanceof B;)b=!0,e.push(d[g].toString().toLowerCase()),g++;for(;d[g]instanceof D;)c=!0,e.push(d[g].toString()),g++;for(;f(d[g]);)e.push(d[g].toString().toLowerCase()),g++;for(;g<d.length;g++)e.push(d[g].toString());return e=e.join(""),b||c||(e=a+"://"+e),e},b.prototype.hasProtocol=function(){return this.v[0]instanceof B},b}(I),N={Base:I,EMAIL:J,NL:L,TEXT:K,URL:M};p.text=H,p.multi=N;var O={__esModule:!0},P=p,Q=l,R=function(a){return new Q.TokenState(a)},S=P.text.DOMAIN,T=P.text.AT,U=P.text.COLON,V=P.text.DOT,W=P.text.PUNCTUATION,X=P.text.LOCALHOST,Y=P.text.NL,Z=P.text.NUM,$=P.text.PLUS,_=P.text.POUND,aa=P.text.PROTOCOL,ba=P.text.QUERY,ca=P.text.SLASH,da=P.text.SYM,ea=P.text.TLD,fa=P.multi.EMAIL,ga=P.multi.NL,ha=P.multi.TEXT,ia=P.multi.URL,ja=R(),ka=R(),la=R(),ma=R(),na=R(),oa=R(),pa=R(ia),qa=R(),ra=R(ia),sa=R(),ta=R(),ua=R(ia),va=R(),wa=R(ia),xa=R(ia),ya=R(),za=R(),Aa=R(),Ba=R(fa),Ca=R(),Da=R(fa),Ea=R(),Fa=R(),Ga=R(),Ha=R(ga);ja.on(Y,Ha),ja.on(aa,ka),ja.on(ca,la),ka.on(ca,la),la.on(ca,ma),ja.on(ea,na),ja.on(S,na),ja.on(X,pa),ja.on(Z,na),ma.on(ea,sa),ma.on(S,sa),ma.on(Z,sa),ma.on(X,ua),na.on(V,oa),sa.on(V,ta),za.on(V,Aa),oa.on(ea,pa),oa.on(S,na),oa.on(Z,na),oa.on(X,na),ta.on(ea,ua),ta.on(S,sa),ta.on(Z,sa),ta.on(X,sa),Aa.on(ea,Ba),Aa.on(S,za),Aa.on(Z,za),Aa.on(X,za),pa.on(V,oa),ua.on(V,ta),Ba.on(V,Aa),pa.on(U,qa),pa.on(ca,xa),qa.on(Z,ra),ra.on(ca,xa),ua.on(U,va),ua.on(ca,xa),va.on(Z,wa),wa.on(ca,xa),Ba.on(U,Ca),Ca.on(Z,Da);var Ia=[S,T,X,Z,$,_,aa,ca,ea,da],Ja=[U,V,ba,W];xa.on(Ia,xa),ya.on(Ia,xa),xa.on(Ja,ya),ya.on(Ja,ya);var Ka=[S,Z,$,_,ba,da,ea];na.on(Ka,Ea),na.on(T,Fa),oa.on(Ka,Ea),pa.on(Ka,Ea),pa.on(T,Fa),Ea.on(Ka,Ea),Ea.on(T,Fa),Ea.on(V,Ga),Ga.on(Ka,Ea),Fa.on(ea,za),Fa.on(S,za),Fa.on(X,Ba);var La=function(a){for(var b=a.length,c=0,d=[],e=[];b>c;){for(var f=ja,g=null,h=null,i=0,j=null,k=-1;b>c&&!(g=f.next(a[c]));)e.push(a[c++]);for(;b>c&&(h=g||f.next(a[c]));)g=null,f=h,f.accepts()?(k=0,j=f):k>=0&&k++,c++,i++;if(0>k)for(i=c-i;c>i;i++)e.push(a[i]);else 0<e.length&&(d.push(new ha(e)),e=[]),c-=k,i-=k,f=j.emit(),d.push(new f(a.slice(c-i,c)))}return 0<e.length&&d.push(new ha(e)),d},Ma=P.multi,Na=ja;O.State=Q.TokenState,O.TOKENS=Ma,O.run=La,O.start=Na;var Oa={__esModule:!0},Pa=p,Qa=l,Ra="abogado ac academy accountants active actor ad adult ae aero af ag agency ai airforce al allfinanz alsace am an android ao aq aquarelle ar archi army arpa as asia associates at attorney au auction audio autos aw ax axa az ba band bar bargains bayern bb bd be beer berlin best bf bg bh bi bid bike bio biz bj black blackfriday bloomberg blue bm bmw bn bnpparibas bo boo boutique br brussels bs bt budapest build builders business buzz bv bw by bz bzh ca cab cal camera camp cancerresearch capetown capital caravan cards care career careers casa cash cat catering cc cd center ceo cern cf cg ch channel cheap christmas chrome church ci citic city ck cl claims cleaning click clinic clothing club cm cn co coach codes coffee college cologne com community company computer condos construction consulting contractors cooking cool coop country cr credit creditcard cricket crs cruises cu cuisinella cv cw cx cy cymru cz dad dance dating day de deals degree delivery democrat dental dentist desi diamonds diet digital direct directory discount dj dk dm dnp do domains durban dvag dz eat ec edu education ee eg email emerck energy engineer engineering enterprises equipment er es esq estate et eu eurovision eus events everbank exchange expert exposed fail farm fashion feedback fi finance financial firmdale fish fishing fitness fj fk flights florist flsmidth fly fm fo foo forsale foundation fr frl frogans fund furniture futbol ga gal gallery gb gbiz gd ge gent gf gg gh gi gift gifts gives gl glass gle global globo gm gmail gmo gmx gn google gop gov gp gq gr graphics gratis green gripe gs gt gu guide guitars guru gw gy hamburg haus healthcare help here hiphop hiv hk hm hn holdings holiday homes horse host hosting house how hr ht hu ibm id ie il im immo immobilien in industries info ing ink institute insure int international investments io iq ir irish is it je jetzt jm jo jobs joburg jp juegos kaufen ke kg kh ki kim kitchen kiwi km kn koeln kp kr krd kred kw ky kz la lacaixa land latrobe lawyer lb lc lds lease legal lgbt li life lighting limited limo link lk loans london lotto lr ls lt ltda lu luxe luxury lv ly ma madrid maison management mango market marketing mc md me media meet melbourne meme memorial menu mg mh miami mil mini mk ml mm mn mo mobi moda moe monash money mormon mortgage moscow motorcycles mov mp mq mr ms mt mu museum mv mw mx my mz na nagoya name navy nc ne net network neustar new nexus nf ng ngo nhk ni ninja nl no np nr nra nrw nu nyc nz okinawa om ong onl ooo org organic otsuka ovh pa paris partners parts party pe pf pg ph pharmacy photo photography photos physio pics pictures pink pizza pk pl place plumbing pm pn pohl poker porn post pr praxi press pro prod productions prof properties property ps pt pub pw py qa qpon quebec re realtor recipes red rehab reise reisen reit ren rentals repair report republican rest restaurant reviews rich rio rip ro rocks rodeo rs rsvp ru ruhr rw ryukyu sa saarland sarl sb sc sca scb schmidt schule science scot sd se services sexy sg sh shiksha shoes si singles sj sk sl sm sn so social software sohu solar solutions soy space spiegel sr st su supplies supply support surf surgery suzuki sv sx sy sydney systems sz taipei tatar tattoo tax tc td technology tel tf tg th tienda tips tirol tj tk tl tm tn to today tokyo tools top town toys tp tr trade training travel trust tt tui tv tw tz ua ug uk university uno uol us uy uz va vacations vc ve vegas ventures versicherung vet vg vi viajes villas vision vlaanderen vn vodka vote voting voto voyage vu wales wang watch webcam website wed wedding wf whoswho wien wiki williamhill wme work works world ws wtc wtf xxx xyz yachts yandex ye yoga yokohama youtube yt za zip zm zone zw".split(" "),Sa=/[0-9]/,Ta=/[a-z0-9]/,Ua=":",Va=[],Wa=function(a){return new Qa.CharacterState(a)},Xa=Pa.text.DOMAIN,Ya=Pa.text.LOCALHOST,Za=Pa.text.NUM,$a=Pa.text.PROTOCOL,_a=Pa.text.TLD,ab=Pa.text.WS,bb=Wa(),cb=Wa(Za),db=Wa(Xa),eb=Wa(),fb=Wa(ab);bb.on("@",Wa(Pa.text.AT)),bb.on(".",Wa(Pa.text.DOT)),bb.on("+",Wa(Pa.text.PLUS)),bb.on("#",Wa(Pa.text.POUND)),bb.on("?",Wa(Pa.text.QUERY)),bb.on("/",Wa(Pa.text.SLASH)),bb.on(Ua,Wa(Pa.text.COLON)),bb.on(/[,;!]/,Wa(Pa.text.PUNCTUATION)),bb.on(/\n/,Wa(Pa.text.NL)),bb.on(/\s/,fb),fb.on(/[^\S\n]/,fb);for(var gb=0;gb<Ra.length;gb++){var hb=Qa.stateify(Ra[gb],bb,_a,Xa);Va.push.apply(Va,hb)}var ib=Qa.stateify("file",bb,Xa,Xa),jb=Qa.stateify("ftp",bb,Xa,Xa),kb=Qa.stateify("http",bb,Xa,Xa);Va.push.apply(Va,ib),Va.push.apply(Va,jb),Va.push.apply(Va,kb);var lb=ib.pop(),mb=jb.pop(),nb=kb.pop(),ob=Wa(Xa),pb=Wa($a);mb.on("s",ob),nb.on("s",ob),Va.push(ob),lb.on(Ua,pb),mb.on(Ua,pb),nb.on(Ua,pb),ob.on(Ua,pb);var qb=Qa.stateify("localhost",bb,Ya,Xa);for(Va.push.apply(Va,qb),bb.on(Sa,cb),cb.on("-",eb),cb.on(Sa,cb),cb.on(Ta,db),db.on("-",eb),db.on(Ta,db),gb=0;gb<Va.length;gb++)Va[gb].on("-",eb),Va[gb].on(Ta,db);eb.on("-",eb),eb.on(Sa,db),eb.on(Ta,db),bb.on(/./,Wa(Pa.text.SYM));var rb=function(a){for(var b=a.replace(/[A-Z]/g,function(a){return a.toLowerCase()}),c=a.length,d=[],e=0;c>e;){for(var f=bb,g=null,h=0,i=null,j=-1;c>e&&(g=f.next(b[e]));)f=g,f.accepts()?(j=0,i=f):j>=0&&j++,h++,e++;0>j||(e-=j,h-=j,f=i.emit(),d.push(new f(a.substr(e-h,h))))}return d},sb=bb;Oa.State=Qa.CharacterState,Oa.TOKENS=Pa.text,Oa.run=rb,Oa.start=sb;var tb={__esModule:!0};tb.normalize=i,tb.resolve=j;var ub={__esModule:!0},vb=tb,wb=k(vb),xb=Oa,yb=k(xb),zb=O,Ab=k(zb);Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var Bb=function(a){return Ab.run(yb.run(a))},Cb=function(a){for(var b=1>=arguments.length||void 0===arguments[1]?null:arguments[1],c=Bb(a),d=[],e=0;e<c.length;e++)!c[e].isLink||b&&c[e].type!==b||d.push(c[e].toObject());return d},Db=function(a){var b=1>=arguments.length||void 0===arguments[1]?null:arguments[1],c=Bb(a);return 1===c.length&&c[0].isLink&&(!b||c[0].type===b)};ub.find=Cb,ub.options=wb,ub.parser=Ab,ub.scanner=yb,ub.test=Db,ub.tokenize=Bb,window.linkify=ub}(),function(a,b){function c(a,b,c){var d=c[c.length-1];a.replaceChild(d,b);for(var e=c.length-2;e>=0;e--)a.insertBefore(c[e],d),d=c[e]}function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];if(f.isLink){var g=f.toHref(b.defaultProtocol),h=i.resolve(b.format,f.toString(),f.type),j=i.resolve(b.formatHref,g,f.type),k=i.resolve(b.attributes,g,f.type),l=i.resolve(b.tagName,g,f.type),m=i.resolve(b.linkClass,g,f.type),n=i.resolve(b.target,g,f.type),o=i.resolve(b.events,g,f.type),p=c.createElement(l);if(p.setAttribute("href",j),p.setAttribute("class",m),n&&p.setAttribute("target",n),k)for(var q in k)p.setAttribute(q,k[q]);if(o)for(var r in o)p.addEventListener?p.addEventListener(r,o[r]):p.attachEvent&&p.attachEvent("on"+r,o[r]);p.appendChild(c.createTextNode(h)),d.push(p)}else"nl"===f.type&&b.nl2br?d.push(c.createElement("br")):d.push(c.createTextNode(f.toString()))}return d}function e(a,b,f){if(!a||"object"!=typeof a||a.nodeType!==j)throw new Error("Cannot linkify "+a+" - Invalid DOM Node type");if("A"===a.tagName)return a;for(var g=a.firstChild;g;){switch(g.nodeType){case j:e(g,b,f);break;case k:var i=g.nodeValue,l=h(i),m=d(l,b,f);c(a,g,m),g=m[m.length-1]}g=g.nextSibling}return a}function f(a,b){var c=arguments.length<=2||void 0===arguments[2]?null:arguments[2];try{c=c||window&&window.document||global&&global.document}catch(d){}if(!c)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");return b=i.normalize(b),e(a,b,c)}function g(a){function b(a){return a=f.normalize(a),this.each(function(){f.helper(this,a,c)})}var c=arguments.length<=1||void 0===arguments[1]?null:arguments[1];a.fn=a.fn||{};try{c=c||window&&window.document||global&&global.document}catch(d){}if(!c)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");"function"!=typeof a.fn.linkify&&(a.fn.linkify=b,a(c).ready(function(){a("[data-linkify]").each(function(){var b=a(this),c=b.data(),d=c.linkify,e=c.linkifyNlbr,f={linkAttributes:c.linkifyAttributes,defaultProtocol:c.linkifyDefaultProtocol,events:c.linkifyEvents,format:c.linkifyFormat,formatHref:c.linkifyFormatHref,newLine:c.linkifyNewline,nl2br:!!e&&0!==e&&"false"!==e,tagName:c.linkifyTagname,target:c.linkifyTarget,linkClass:c.linkifyLinkclass},g="this"===d?b:b.find(d);g.linkify(f)})}))}var h=b.tokenize,i=b.options,j=1,k=3;f.helper=e,f.normalize=i.normalize;var l=void 0;try{l=document}catch(m){l=null}"undefined"!=typeof a&&l&&g(a,l),window.linkifyElement=f}(window.jQuery,window.linkify),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a){"undefined"!=typeof module&&module.exports?module.exports=a:a(jQuery,window,document)}(function(a){!function(b){var c="function"==typeof define&&define.amd,d="undefined"!=typeof module&&module.exports,e="https:"==document.location.protocol?"https:":"http:",f="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";c||(d?require("jquery-mousewheel")(a):a.event.special.mousewheel||a("head").append(decodeURI("%3Cscript src="+e+"//"+f+"%3E%3C/script%3E"))),b()}(function(){var b,c="mCustomScrollbar",d="mCS",e=".mCustomScrollbar",f={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},g=0,h={},i=window.attachEvent&&!window.addEventListener?1:0,j=!1,k=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],l={init:function(b){var b=a.extend(!0,{},f,b),c=m.call(this);if(b.live){var i=b.liveSelector||this.selector||e,j=a(i);if("off"===b.live)return void o(i);h[i]=setTimeout(function(){j.mCustomScrollbar(b),"once"===b.live&&j.length&&o(i)},500)}else o(i);return b.setWidth=b.set_width?b.set_width:b.setWidth,b.setHeight=b.set_height?b.set_height:b.setHeight,b.axis=b.horizontalScroll?"x":p(b.axis),b.scrollInertia=b.scrollInertia>0&&b.scrollInertia<17?17:b.scrollInertia,"object"!=typeof b.mouseWheel&&1==b.mouseWheel&&(b.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),b.mouseWheel.scrollAmount=b.mouseWheelPixels?b.mouseWheelPixels:b.mouseWheel.scrollAmount,b.mouseWheel.normalizeDelta=b.advanced.normalizeMouseWheelDelta?b.advanced.normalizeMouseWheelDelta:b.mouseWheel.normalizeDelta,b.scrollButtons.scrollType=q(b.scrollButtons.scrollType),n(b),a(c).each(function(){var c=a(this);if(!c.data(d)){c.data(d,{idx:++g,opt:b,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:c.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var e=c.data(d),f=e.opt,h=c.data("mcs-axis"),i=c.data("mcs-scrollbar-position"),j=c.data("mcs-theme");h&&(f.axis=h),i&&(f.scrollbarPosition=i),j&&(f.theme=j,n(f)),r.call(this),e&&f.callbacks.onCreate&&"function"==typeof f.callbacks.onCreate&&f.callbacks.onCreate.call(this),a("#mCSB_"+e.idx+"_container img:not(."+k[2]+")").addClass(k[2]),l.update.call(null,c)}})},update:function(b,c){var e=b||m.call(this);return a(e).each(function(){var b=a(this);if(b.data(d)){var e=b.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container"),h=a("#mCSB_"+e.idx),i=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];if(!g.length)return;e.tweenRunning&&U(b),c&&e&&f.callbacks.onBeforeUpdate&&"function"==typeof f.callbacks.onBeforeUpdate&&f.callbacks.onBeforeUpdate.call(this),b.hasClass(k[3])&&b.removeClass(k[3]),b.hasClass(k[4])&&b.removeClass(k[4]),h.css("max-height","none"),h.height()!==b.height()&&h.css("max-height",b.height()),t.call(this),"y"===f.axis||f.advanced.autoExpandHorizontalScroll||g.css("width",s(g)),e.overflowed=y.call(this),C.call(this),f.autoDraggerLength&&v.call(this),w.call(this),A.call(this);var j=[Math.abs(g[0].offsetTop),Math.abs(g[0].offsetLeft)];"x"!==f.axis&&(e.overflowed[0]?i[0].height()>i[0].parent().height()?z.call(this):(V(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}),e.contentReset.y=null):(z.call(this),"y"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[1]&&V(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==f.axis&&(e.overflowed[1]?i[1].width()>i[1].parent().width()?z.call(this):(V(b,j[1].toString(),{dir:"x",dur:0,overwrite:"none"}),e.contentReset.x=null):(z.call(this),"x"===f.axis?B.call(this):"yx"===f.axis&&e.overflowed[0]&&V(b,j[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),c&&e&&(2===c&&f.callbacks.onImageLoad&&"function"==typeof f.callbacks.onImageLoad?f.callbacks.onImageLoad.call(this):3===c&&f.callbacks.onSelectorChange&&"function"==typeof f.callbacks.onSelectorChange?f.callbacks.onSelectorChange.call(this):f.callbacks.onUpdate&&"function"==typeof f.callbacks.onUpdate&&f.callbacks.onUpdate.call(this)),S.call(this)}})},scrollTo:function(b,c){if("undefined"!=typeof b&&null!=b){var e=m.call(this);return a(e).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h={trigger:"external",scrollInertia:g.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},i=a.extend(!0,{},h,c),j=Q.call(this,b),k=i.scrollInertia>0&&i.scrollInertia<17?17:i.scrollInertia;j[0]=R.call(this,j[0],"y"),j[1]=R.call(this,j[1],"x"),i.moveDragger&&(j[0]*=f.scrollRatio.y,j[1]*=f.scrollRatio.x),i.dur=ca()?0:k,setTimeout(function(){null!==j[0]&&"undefined"!=typeof j[0]&&"x"!==g.axis&&f.overflowed[0]&&(i.dir="y",i.overwrite="all",V(e,j[0].toString(),i)),null!==j[1]&&"undefined"!=typeof j[1]&&"y"!==g.axis&&f.overflowed[1]&&(i.dir="x",i.overwrite="none",V(e,j[1].toString(),i))},i.timeout)}})}},stop:function(){var b=m.call(this);return a(b).each(function(){var b=a(this);b.data(d)&&U(b)})},disable:function(b){var c=m.call(this);return a(c).each(function(){var c=a(this);if(c.data(d)){c.data(d);S.call(this,"remove"),B.call(this),b&&z.call(this),C.call(this,!0),c.addClass(k[3])}})},destroy:function(){var b=m.call(this);return a(b).each(function(){var e=a(this);if(e.data(d)){var f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx),i=a("#mCSB_"+f.idx+"_container"),j=a(".mCSB_"+f.idx+"_scrollbar");g.live&&o(g.liveSelector||a(b).selector),S.call(this,"remove"),B.call(this),z.call(this),e.removeData(d),Z(this,"mcs"),j.remove(),i.find("img."+k[2]).removeClass(k[2]),h.replaceWith(i.contents()),e.removeClass(c+" _"+d+"_"+f.idx+" "+k[6]+" "+k[7]+" "+k[5]+" "+k[3]).addClass(k[4])}})}},m=function(){return"object"!=typeof a(this)||a(this).length<1?e:this},n=function(b){var c=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],d=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],e=["minimal","minimal-dark"],f=["minimal","minimal-dark"],g=["minimal","minimal-dark"];b.autoDraggerLength=a.inArray(b.theme,c)>-1?!1:b.autoDraggerLength,b.autoExpandScrollbar=a.inArray(b.theme,d)>-1?!1:b.autoExpandScrollbar,b.scrollButtons.enable=a.inArray(b.theme,e)>-1?!1:b.scrollButtons.enable,b.autoHideScrollbar=a.inArray(b.theme,f)>-1?!0:b.autoHideScrollbar,b.scrollbarPosition=a.inArray(b.theme,g)>-1?"outside":b.scrollbarPosition},o=function(a){h[a]&&(clearTimeout(h[a]),Z(h,a))},p=function(a){return"yx"===a||"xy"===a||"auto"===a?"yx":"x"===a||"horizontal"===a?"x":"y"},q=function(a){return"stepped"===a||"pixels"===a||"step"===a||"click"===a?"stepped":"stepless"},r=function(){var b=a(this),e=b.data(d),f=e.opt,g=f.autoExpandScrollbar?" "+k[1]+"_expand":"",h=["<div id='mCSB_"+e.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_vertical"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+e.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+e.idx+"_scrollbar mCS-"+f.theme+" mCSB_scrollTools_horizontal"+g+"'><div class='"+k[12]+"'><div id='mCSB_"+e.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],i="yx"===f.axis?"mCSB_vertical_horizontal":"x"===f.axis?"mCSB_horizontal":"mCSB_vertical",j="yx"===f.axis?h[0]+h[1]:"x"===f.axis?h[1]:h[0],l="yx"===f.axis?"<div id='mCSB_"+e.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",m=f.autoHideScrollbar?" "+k[6]:"",n="x"!==f.axis&&"rtl"===e.langDir?" "+k[7]:"";f.setWidth&&b.css("width",f.setWidth),f.setHeight&&b.css("height",f.setHeight),f.setLeft="y"!==f.axis&&"rtl"===e.langDir?"989999px":f.setLeft,b.addClass(c+" _"+d+"_"+e.idx+m+n).wrapInner("<div id='mCSB_"+e.idx+"' class='mCustomScrollBox mCS-"+f.theme+" "+i+"'><div id='mCSB_"+e.idx+"_container' class='mCSB_container' style='position:relative; top:"+f.setTop+"; left:"+f.setLeft+";' dir="+e.langDir+" /></div>");var o=a("#mCSB_"+e.idx),p=a("#mCSB_"+e.idx+"_container");"y"===f.axis||f.advanced.autoExpandHorizontalScroll||p.css("width",s(p)),"outside"===f.scrollbarPosition?("static"===b.css("position")&&b.css("position","relative"),b.css("overflow","visible"),o.addClass("mCSB_outside").after(j)):(o.addClass("mCSB_inside").append(j),p.wrap(l)),u.call(this);var q=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")];q[0].css("min-height",q[0].height()),q[1].css("min-width",q[1].width())},s=function(b){var c=[b[0].scrollWidth,Math.max.apply(Math,b.children().map(function(){return a(this).outerWidth(!0)}).get())],d=b.parent().width();return c[0]>d?c[0]:c[1]>d?c[1]:"100%"},t=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx+"_container");if(e.advanced.autoExpandHorizontalScroll&&"y"!==e.axis){f.css({width:"auto",
"min-width":0,"overflow-x":"scroll"});var g=Math.ceil(f[0].scrollWidth);3===e.advanced.autoExpandHorizontalScroll||2!==e.advanced.autoExpandHorizontalScroll&&g>f.parent().width()?f.css({width:g,"min-width":"100%","overflow-x":"inherit"}):f.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(f[0].getBoundingClientRect().right+.4)-Math.floor(f[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},u=function(){var b=a(this),c=b.data(d),e=c.opt,f=a(".mCSB_"+c.idx+"_scrollbar:first"),g=aa(e.scrollButtons.tabindex)?"tabindex='"+e.scrollButtons.tabindex+"'":"",h=["<a href='#' class='"+k[13]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[14]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[15]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+k[16]+"' oncontextmenu='return false;' "+g+" />"],i=["x"===e.axis?h[2]:h[0],"x"===e.axis?h[3]:h[1],h[2],h[3]];e.scrollButtons.enable&&f.prepend(i[0]).append(i[1]).next(".mCSB_scrollTools").prepend(i[2]).append(i[3])},v=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[e.height()/f.outerHeight(!1),e.width()/f.outerWidth(!1)],j=[parseInt(g[0].css("min-height")),Math.round(h[0]*g[0].parent().height()),parseInt(g[1].css("min-width")),Math.round(h[1]*g[1].parent().width())],k=i&&j[1]<j[0]?j[0]:j[1],l=i&&j[3]<j[2]?j[2]:j[3];g[0].css({height:k,"max-height":g[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":j[0]+"px"}),g[1].css({width:l,"max-width":g[1].parent().width()-10})},w=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[f.outerHeight(!1)-e.height(),f.outerWidth(!1)-e.width()],i=[h[0]/(g[0].parent().height()-g[0].height()),h[1]/(g[1].parent().width()-g[1].width())];c.scrollRatio={y:i[0],x:i[1]}},x=function(a,b,c){var d=c?k[0]+"_expanded":"",e=a.closest(".mCSB_scrollTools");"active"===b?(a.toggleClass(k[0]+" "+d),e.toggleClass(k[1]),a[0]._draggable=a[0]._draggable?0:1):a[0]._draggable||("hide"===b?(a.removeClass(k[0]),e.removeClass(k[1])):(a.addClass(k[0]),e.addClass(k[1])))},y=function(){var b=a(this),c=b.data(d),e=a("#mCSB_"+c.idx),f=a("#mCSB_"+c.idx+"_container"),g=null==c.overflowed?f.height():f.outerHeight(!1),h=null==c.overflowed?f.width():f.outerWidth(!1),i=f[0].scrollHeight,j=f[0].scrollWidth;return i>g&&(g=i),j>h&&(h=j),[g>e.height(),h>e.width()]},z=function(){var b=a(this),c=b.data(d),e=c.opt,f=a("#mCSB_"+c.idx),g=a("#mCSB_"+c.idx+"_container"),h=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")];if(U(b),("x"!==e.axis&&!c.overflowed[0]||"y"===e.axis&&c.overflowed[0])&&(h[0].add(g).css("top",0),V(b,"_resetY")),"y"!==e.axis&&!c.overflowed[1]||"x"===e.axis&&c.overflowed[1]){var i=dx=0;"rtl"===c.langDir&&(i=f.width()-g.outerWidth(!1),dx=Math.abs(i/c.scrollRatio.x)),g.css("left",i),h[1].css("left",dx),V(b,"_resetX")}},A=function(){function b(){g=setTimeout(function(){a.event.special.mousewheel?(clearTimeout(g),H.call(c[0])):b()},100)}var c=a(this),e=c.data(d),f=e.opt;if(!e.bindEvents){if(E.call(this),f.contentTouchScroll&&F.call(this),G.call(this),f.mouseWheel.enable){var g;b()}K.call(this),M.call(this),f.advanced.autoScrollOnFocus&&L.call(this),f.scrollButtons.enable&&N.call(this),f.keyboard.enable&&O.call(this),e.bindEvents=!0}},B=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=".mCSB_"+c.idx+"_scrollbar",h=a("#mCSB_"+c.idx+",#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,"+g+" ."+k[12]+",#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal,"+g+">a"),i=a("#mCSB_"+c.idx+"_container");e.advanced.releaseDraggableSelectors&&h.add(a(e.advanced.releaseDraggableSelectors)),e.advanced.extraDraggableSelectors&&h.add(a(e.advanced.extraDraggableSelectors)),c.bindEvents&&(a(document).add(a(!I()||top.document)).unbind("."+f),h.each(function(){a(this).unbind("."+f)}),clearTimeout(b[0]._focusTimeout),Z(b[0],"_focusTimeout"),clearTimeout(c.sequential.step),Z(c.sequential,"step"),clearTimeout(i[0].onCompleteTimeout),Z(i[0],"onCompleteTimeout"),c.bindEvents=!1)},C=function(b){var c=a(this),e=c.data(d),f=e.opt,g=a("#mCSB_"+e.idx+"_container_wrapper"),h=g.length?g:a("#mCSB_"+e.idx+"_container"),i=[a("#mCSB_"+e.idx+"_scrollbar_vertical"),a("#mCSB_"+e.idx+"_scrollbar_horizontal")],j=[i[0].find(".mCSB_dragger"),i[1].find(".mCSB_dragger")];"x"!==f.axis&&(e.overflowed[0]&&!b?(i[0].add(j[0]).add(i[0].children("a")).css("display","block"),h.removeClass(k[8]+" "+k[10])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[0].css("display","none"),h.removeClass(k[10])):(i[0].css("display","none"),h.addClass(k[10])),h.addClass(k[8]))),"y"!==f.axis&&(e.overflowed[1]&&!b?(i[1].add(j[1]).add(i[1].children("a")).css("display","block"),h.removeClass(k[9]+" "+k[11])):(f.alwaysShowScrollbar?(2!==f.alwaysShowScrollbar&&j[1].css("display","none"),h.removeClass(k[11])):(i[1].css("display","none"),h.addClass(k[11])),h.addClass(k[9]))),e.overflowed[0]||e.overflowed[1]?c.removeClass(k[5]):c.addClass(k[5])},D=function(b){var c=b.type,d=b.target.ownerDocument!==document?[a(frameElement).offset().top,a(frameElement).offset().left]:null,e=I()&&b.target.ownerDocument!==top.document?[a(b.view.frameElement).offset().top,a(b.view.frameElement).offset().left]:[0,0];switch(c){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return d?[b.originalEvent.pageY-d[0]+e[0],b.originalEvent.pageX-d[1]+e[1],!1]:[b.originalEvent.pageY,b.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var f=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],g=b.originalEvent.touches.length||b.originalEvent.changedTouches.length;return b.target.ownerDocument!==document?[f.screenY,f.screenX,g>1]:[f.pageY,f.pageX,g>1];default:return d?[b.pageY-d[0]+e[0],b.pageX-d[1]+e[1],!1]:[b.pageY,b.pageX,!1]}},E=function(){function b(a){var b=o.find("iframe");if(b.length){var c=a?"auto":"none";b.css("pointer-events",c)}}function c(a,b,c,d){if(o[0].idleTimer=l.scrollInertia<233?250:0,e.attr("id")===n[1])var f="x",g=(e[0].offsetLeft-b+d)*k.scrollRatio.x;else var f="y",g=(e[0].offsetTop-a+c)*k.scrollRatio.y;V(h,g.toString(),{dir:f,drag:!0})}var e,f,g,h=a(this),k=h.data(d),l=k.opt,m=d+"_"+k.idx,n=["mCSB_"+k.idx+"_dragger_vertical","mCSB_"+k.idx+"_dragger_horizontal"],o=a("#mCSB_"+k.idx+"_container"),p=a("#"+n[0]+",#"+n[1]),q=l.advanced.releaseDraggableSelectors?p.add(a(l.advanced.releaseDraggableSelectors)):p,r=l.advanced.extraDraggableSelectors?a(!I()||top.document).add(a(l.advanced.extraDraggableSelectors)):a(!I()||top.document);p.bind("mousedown."+m+" touchstart."+m+" pointerdown."+m+" MSPointerDown."+m,function(c){if(c.stopImmediatePropagation(),c.preventDefault(),$(c)){j=!0,i&&(document.onselectstart=function(){return!1}),b(!1),U(h),e=a(this);var d=e.offset(),k=D(c)[0]-d.top,m=D(c)[1]-d.left,n=e.height()+d.top,o=e.width()+d.left;n>k&&k>0&&o>m&&m>0&&(f=k,g=m),x(e,"active",l.autoExpandScrollbar)}}).bind("touchmove."+m,function(a){a.stopImmediatePropagation(),a.preventDefault();var b=e.offset(),d=D(a)[0]-b.top,h=D(a)[1]-b.left;c(f,g,d,h)}),a(document).add(r).bind("mousemove."+m+" pointermove."+m+" MSPointerMove."+m,function(a){if(e){var b=e.offset(),d=D(a)[0]-b.top,h=D(a)[1]-b.left;if(f===d&&g===h)return;c(f,g,d,h)}}).add(q).bind("mouseup."+m+" touchend."+m+" pointerup."+m+" MSPointerUp."+m,function(a){e&&(x(e,"active",l.autoExpandScrollbar),e=null),j=!1,i&&(document.onselectstart=null),b(!0)})},F=function(){function c(a){if(!_(a)||j||D(a)[2])return void(b=0);b=1,w=0,x=0,k=1,y.removeClass("mCS_touch_action");var c=E.offset();l=D(a)[0]-c.top,m=D(a)[1]-c.left,L=[D(a)[0],D(a)[1]]}function e(a){if(_(a)&&!j&&!D(a)[2]&&(A.documentTouchScroll||a.preventDefault(),a.stopImmediatePropagation(),(!x||w)&&k)){q=X();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left,e="mcsLinearOut";if(G.push(c),H.push(d),L[2]=Math.abs(D(a)[0]-L[0]),L[3]=Math.abs(D(a)[1]-L[1]),z.overflowed[0])var f=F[0].parent().height()-F[0].height(),g=l-c>0&&c-l>-(f*z.scrollRatio.y)&&(2*L[3]<L[2]||"yx"===A.axis);if(z.overflowed[1])var h=F[1].parent().width()-F[1].width(),n=m-d>0&&d-m>-(h*z.scrollRatio.x)&&(2*L[2]<L[3]||"yx"===A.axis);g||n?(O||a.preventDefault(),w=1):(x=1,y.addClass("mCS_touch_action")),O&&a.preventDefault(),u="yx"===A.axis?[l-c,m-d]:"x"===A.axis?[null,m-d]:[l-c,null],E[0].idleTimer=250,z.overflowed[0]&&i(u[0],J,e,"y","all",!0),z.overflowed[1]&&i(u[1],J,e,"x",K,!0)}}function f(a){if(!_(a)||j||D(a)[2])return void(b=0);b=1,a.stopImmediatePropagation(),U(y),p=X();var c=C.offset();n=D(a)[0]-c.top,o=D(a)[1]-c.left,G=[],H=[]}function g(a){if(_(a)&&!j&&!D(a)[2]){k=0,a.stopImmediatePropagation(),w=0,x=0,r=X();var b=C.offset(),c=D(a)[0]-b.top,d=D(a)[1]-b.left;if(!(r-q>30)){t=1e3/(r-p);var e="mcsEaseOut",f=2.5>t,g=f?[G[G.length-2],H[H.length-2]]:[0,0];s=f?[c-g[0],d-g[1]]:[c-n,d-o];var l=[Math.abs(s[0]),Math.abs(s[1])];t=f?[Math.abs(s[0]/4),Math.abs(s[1]/4)]:[t,t];var m=[Math.abs(E[0].offsetTop)-s[0]*h(l[0]/t[0],t[0]),Math.abs(E[0].offsetLeft)-s[1]*h(l[1]/t[1],t[1])];u="yx"===A.axis?[m[0],m[1]]:"x"===A.axis?[null,m[1]]:[m[0],null],v=[4*l[0]+A.scrollInertia,4*l[1]+A.scrollInertia];var y=parseInt(A.contentTouchScroll)||0;u[0]=l[0]>y?u[0]:0,u[1]=l[1]>y?u[1]:0,z.overflowed[0]&&i(u[0],v[0],e,"y",K,!1),z.overflowed[1]&&i(u[1],v[1],e,"x",K,!1)}}}function h(a,b){var c=[1.5*b,2*b,b/1.5,b/2];return a>90?b>4?c[0]:c[3]:a>60?b>3?c[3]:c[2]:a>30?b>8?c[1]:b>6?c[0]:b>4?b:c[2]:b>8?b:c[3]}function i(a,b,c,d,e,f){a&&V(y,a.toString(),{dur:b,scrollEasing:c,dir:d,overwrite:e,drag:f})}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=a(this),z=y.data(d),A=z.opt,B=d+"_"+z.idx,C=a("#mCSB_"+z.idx),E=a("#mCSB_"+z.idx+"_container"),F=[a("#mCSB_"+z.idx+"_dragger_vertical"),a("#mCSB_"+z.idx+"_dragger_horizontal")],G=[],H=[],J=0,K="yx"===A.axis?"none":"all",L=[],M=E.find("iframe"),N=["touchstart."+B+" pointerdown."+B+" MSPointerDown."+B,"touchmove."+B+" pointermove."+B+" MSPointerMove."+B,"touchend."+B+" pointerup."+B+" MSPointerUp."+B],O=void 0!==document.body.style.touchAction;E.bind(N[0],function(a){c(a)}).bind(N[1],function(a){e(a)}),C.bind(N[0],function(a){f(a)}).bind(N[2],function(a){g(a)}),M.length&&M.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind(N[0],function(a){c(a),f(a)}).bind(N[1],function(a){e(a)}).bind(N[2],function(a){g(a)})})})},G=function(){function c(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function e(a,b,c){k.type=c&&f?"stepped":"stepless",k.scrollAmount=10,P(g,a,b,"mcsLinearOut",c?60:null)}var f,g=a(this),h=g.data(d),i=h.opt,k=h.sequential,l=d+"_"+h.idx,m=a("#mCSB_"+h.idx+"_container"),n=m.parent();m.bind("mousedown."+l,function(a){b||f||(f=1,j=!0)}).add(document).bind("mousemove."+l,function(a){if(!b&&f&&c()){var d=m.offset(),g=D(a)[0]-d.top+m[0].offsetTop,j=D(a)[1]-d.left+m[0].offsetLeft;g>0&&g<n.height()&&j>0&&j<n.width()?k.step&&e("off",null,"stepped"):("x"!==i.axis&&h.overflowed[0]&&(0>g?e("on",38):g>n.height()&&e("on",40)),"y"!==i.axis&&h.overflowed[1]&&(0>j?e("on",37):j>n.width()&&e("on",39)))}}).bind("mouseup."+l+" dragend."+l,function(a){b||(f&&(f=0,e("off",null)),j=!1)})},H=function(){function b(b,d){if(U(c),!J(c,b.target)){var g="auto"!==f.mouseWheel.deltaFactor?parseInt(f.mouseWheel.deltaFactor):i&&b.deltaFactor<100?100:b.deltaFactor||100,k=f.scrollInertia;if("x"===f.axis||"x"===f.mouseWheel.axis)var l="x",m=[Math.round(g*e.scrollRatio.x),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.width()?.9*h.width():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetLeft),p=j[1][0].offsetLeft,q=j[1].parent().width()-j[1].width(),r=b.deltaX||b.deltaY||d;else var l="y",m=[Math.round(g*e.scrollRatio.y),parseInt(f.mouseWheel.scrollAmount)],n="auto"!==f.mouseWheel.scrollAmount?m[1]:m[0]>=h.height()?.9*h.height():m[0],o=Math.abs(a("#mCSB_"+e.idx+"_container")[0].offsetTop),p=j[0][0].offsetTop,q=j[0].parent().height()-j[0].height(),r=b.deltaY||d;"y"===l&&!e.overflowed[0]||"x"===l&&!e.overflowed[1]||((f.mouseWheel.invert||b.webkitDirectionInvertedFromDevice)&&(r=-r),f.mouseWheel.normalizeDelta&&(r=0>r?-1:1),(r>0&&0!==p||0>r&&p!==q||f.mouseWheel.preventDefault)&&(b.stopImmediatePropagation(),b.preventDefault()),b.deltaFactor<2&&!f.mouseWheel.normalizeDelta&&(n=b.deltaFactor,k=17),V(c,(o-r*n).toString(),{dir:l,dur:k}))}}if(a(this).data(d)){var c=a(this),e=c.data(d),f=e.opt,g=d+"_"+e.idx,h=a("#mCSB_"+e.idx),j=[a("#mCSB_"+e.idx+"_dragger_vertical"),a("#mCSB_"+e.idx+"_dragger_horizontal")],k=a("#mCSB_"+e.idx+"_container").find("iframe");k.length&&k.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind("mousewheel."+g,function(a,c){b(a,c)})})}),h.bind("mousewheel."+g,function(a,c){b(a,c)})}},I=function(a){var b=null;if(a){try{var c=a.contentDocument||a.contentWindow.document;b=c.body.innerHTML}catch(d){}return null!==b}try{var c=top.document;b=c.body.innerHTML}catch(d){}return null!==b},J=function(b,c){var e=c.nodeName.toLowerCase(),f=b.data(d).opt.mouseWheel.disableOver,g=["select","textarea"];return a.inArray(e,f)>-1&&!(a.inArray(e,g)>-1&&!a(c).is(":focus"))},K=function(){var b,c=a(this),e=c.data(d),f=d+"_"+e.idx,g=a("#mCSB_"+e.idx+"_container"),h=g.parent(),i=a(".mCSB_"+e.idx+"_scrollbar ."+k[12]);i.bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(c){j=!0,a(c.target).hasClass("mCSB_dragger")||(b=1)}).bind("touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(a){j=!1}).bind("click."+f,function(d){if(b&&(b=0,a(d.target).hasClass(k[12])||a(d.target).hasClass("mCSB_draggerRail"))){U(c);var f=a(this),i=f.find(".mCSB_dragger");if(f.parent(".mCSB_scrollTools_horizontal").length>0){if(!e.overflowed[1])return;var j="x",l=d.pageX>i.offset().left?-1:1,m=Math.abs(g[0].offsetLeft)-l*(.9*h.width())}else{if(!e.overflowed[0])return;var j="y",l=d.pageY>i.offset().top?-1:1,m=Math.abs(g[0].offsetTop)-l*(.9*h.height())}V(c,m.toString(),{dir:j,scrollEasing:"mcsEaseInOut"})}})},L=function(){var b=a(this),c=b.data(d),e=c.opt,f=d+"_"+c.idx,g=a("#mCSB_"+c.idx+"_container"),h=g.parent();g.bind("focusin."+f,function(c){var d=a(document.activeElement),f=g.find(".mCustomScrollBox").length,i=0;d.is(e.advanced.autoScrollOnFocus)&&(U(b),clearTimeout(b[0]._focusTimeout),b[0]._focusTimer=f?(i+17)*f:0,b[0]._focusTimeout=setTimeout(function(){var a=[ba(d)[0],ba(d)[1]],c=[g[0].offsetTop,g[0].offsetLeft],f=[c[0]+a[0]>=0&&c[0]+a[0]<h.height()-d.outerHeight(!1),c[1]+a[1]>=0&&c[0]+a[1]<h.width()-d.outerWidth(!1)],j="yx"!==e.axis||f[0]||f[1]?"all":"none";"x"===e.axis||f[0]||V(b,a[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i}),"y"===e.axis||f[1]||V(b,a[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:j,dur:i})},b[0]._focusTimer))})},M=function(){var b=a(this),c=b.data(d),e=d+"_"+c.idx,f=a("#mCSB_"+c.idx+"_container").parent();f.bind("scroll."+e,function(b){(0!==f.scrollTop()||0!==f.scrollLeft())&&a(".mCSB_"+c.idx+"_scrollbar").css("visibility","hidden")})},N=function(){var b=a(this),c=b.data(d),e=c.opt,f=c.sequential,g=d+"_"+c.idx,h=".mCSB_"+c.idx+"_scrollbar",i=a(h+">a");i.bind("mousedown."+g+" touchstart."+g+" pointerdown."+g+" MSPointerDown."+g+" mouseup."+g+" touchend."+g+" pointerup."+g+" MSPointerUp."+g+" mouseout."+g+" pointerout."+g+" MSPointerOut."+g+" click."+g,function(d){function g(a,c){f.scrollAmount=e.scrollButtons.scrollAmount,P(b,a,c)}if(d.preventDefault(),$(d)){var h=a(this).attr("class");switch(f.type=e.scrollButtons.scrollType,d.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===f.type)return;j=!0,c.tweenRunning=!1,g("on",h);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===f.type)return;j=!1,f.dir&&g("off",h);break;case"click":if("stepped"!==f.type||c.tweenRunning)return;g("on",h)}}})},O=function(){function b(b){function d(a,b){g.type=f.keyboard.scrollType,g.scrollAmount=f.keyboard.scrollAmount,"stepped"===g.type&&e.tweenRunning||P(c,a,b)}switch(b.type){case"blur":e.tweenRunning&&g.dir&&d("off",null);break;case"keydown":case"keyup":var h=b.keyCode?b.keyCode:b.which,i="on";if("x"!==f.axis&&(38===h||40===h)||"y"!==f.axis&&(37===h||39===h)){if((38===h||40===h)&&!e.overflowed[0]||(37===h||39===h)&&!e.overflowed[1])return;"keyup"===b.type&&(i="off"),a(document.activeElement).is(l)||(b.preventDefault(),b.stopImmediatePropagation(),d(i,h))}else if(33===h||34===h){if((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type){U(c);var m=34===h?-1:1;if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=Math.abs(j[0].offsetLeft)-m*(.9*k.width());else var n="y",o=Math.abs(j[0].offsetTop)-m*(.9*k.height());V(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}else if((35===h||36===h)&&!a(document.activeElement).is(l)&&((e.overflowed[0]||e.overflowed[1])&&(b.preventDefault(),b.stopImmediatePropagation()),"keyup"===b.type)){if("x"===f.axis||"yx"===f.axis&&e.overflowed[1]&&!e.overflowed[0])var n="x",o=35===h?Math.abs(k.width()-j.outerWidth(!1)):0;else var n="y",o=35===h?Math.abs(k.height()-j.outerHeight(!1)):0;V(c,o.toString(),{dir:n,scrollEasing:"mcsEaseInOut"})}}}var c=a(this),e=c.data(d),f=e.opt,g=e.sequential,h=d+"_"+e.idx,i=a("#mCSB_"+e.idx),j=a("#mCSB_"+e.idx+"_container"),k=j.parent(),l="input,textarea,select,datalist,keygen,[contenteditable='true']",m=j.find("iframe"),n=["blur."+h+" keydown."+h+" keyup."+h];m.length&&m.each(function(){a(this).load(function(){I(this)&&a(this.contentDocument||this.contentWindow.document).bind(n[0],function(a){b(a)})})}),i.attr("tabindex","0").bind(n[0],function(a){b(a)})},P=function(b,c,e,f,g){function h(a){l.snapAmount&&(m.scrollAmount=l.snapAmount instanceof Array?"x"===m.dir[0]?l.snapAmount[1]:l.snapAmount[0]:l.snapAmount);var c="stepped"!==m.type,d=g?g:a?c?p/1.5:q:1e3/60,e=a?c?7.5:40:2.5,i=[Math.abs(n[0].offsetTop),Math.abs(n[0].offsetLeft)],k=[j.scrollRatio.y>10?10:j.scrollRatio.y,j.scrollRatio.x>10?10:j.scrollRatio.x],o="x"===m.dir[0]?i[1]+m.dir[1]*(k[1]*e):i[0]+m.dir[1]*(k[0]*e),r="x"===m.dir[0]?i[1]+m.dir[1]*parseInt(m.scrollAmount):i[0]+m.dir[1]*parseInt(m.scrollAmount),s="auto"!==m.scrollAmount?r:o,t=f?f:a?c?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",u=a?!0:!1;return a&&17>d&&(s="x"===m.dir[0]?i[1]:i[0]),V(b,s.toString(),{dir:m.dir[0],scrollEasing:t,dur:d,onComplete:u}),a?void(m.dir=!1):(clearTimeout(m.step),void(m.step=setTimeout(function(){h()},d)))}function i(){clearTimeout(m.step),Z(m,"step"),U(b)}var j=b.data(d),l=j.opt,m=j.sequential,n=a("#mCSB_"+j.idx+"_container"),o="stepped"===m.type?!0:!1,p=l.scrollInertia<26?26:l.scrollInertia,q=l.scrollInertia<1?17:l.scrollInertia;switch(c){case"on":if(m.dir=[e===k[16]||e===k[15]||39===e||37===e?"x":"y",e===k[13]||e===k[15]||38===e||37===e?-1:1],U(b),aa(e)&&"stepped"===m.type)return;h(o);break;case"off":i(),(o||j.tweenRunning&&m.dir)&&h(!0)}},Q=function(b){var c=a(this).data(d).opt,e=[];return"function"==typeof b&&(b=b()),b instanceof Array?e=b.length>1?[b[0],b[1]]:"x"===c.axis?[null,b[0]]:[b[0],null]:(e[0]=b.y?b.y:b.x||"x"===c.axis?null:b,e[1]=b.x?b.x:b.y||"y"===c.axis?null:b),"function"==typeof e[0]&&(e[0]=e[0]()),"function"==typeof e[1]&&(e[1]=e[1]()),e},R=function(b,c){if(null!=b&&"undefined"!=typeof b){var e=a(this),f=e.data(d),g=f.opt,h=a("#mCSB_"+f.idx+"_container"),i=h.parent(),j=typeof b;c||(c="x"===g.axis?"x":"y");var k="x"===c?h.outerWidth(!1):h.outerHeight(!1),m="x"===c?h[0].offsetLeft:h[0].offsetTop,n="x"===c?"left":"top";switch(j){case"function":return b();case"object":var o=b.jquery?b:a(b);if(!o.length)return;return"x"===c?ba(o)[1]:ba(o)[0];case"string":case"number":if(aa(b))return Math.abs(b);if(-1!==b.indexOf("%"))return Math.abs(k*parseInt(b)/100);if(-1!==b.indexOf("-="))return Math.abs(m-parseInt(b.split("-=")[1]));if(-1!==b.indexOf("+=")){var p=m+parseInt(b.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==b.indexOf("px")&&aa(b.split("px")[0]))return Math.abs(b.split("px")[0]);if("top"===b||"left"===b)return 0;if("bottom"===b)return Math.abs(i.height()-h.outerHeight(!1));if("right"===b)return Math.abs(i.width()-h.outerWidth(!1));if("first"===b||"last"===b){var o=h.find(":"+b);return"x"===c?ba(o)[1]:ba(o)[0]}return a(b).length?"x"===c?ba(a(b))[1]:ba(a(b))[0]:(h.css(n,b),void l.update.call(null,e[0]))}}},S=function(b){function c(){return clearTimeout(m[0].autoUpdate),0===h.parents("html").length?void(h=null):void(m[0].autoUpdate=setTimeout(function(){return j.advanced.updateOnSelectorChange&&(i.poll.change.n=f(),i.poll.change.n!==i.poll.change.o)?(i.poll.change.o=i.poll.change.n,void g(3)):j.advanced.updateOnContentResize&&(i.poll.size.n=h[0].scrollHeight+h[0].scrollWidth+m[0].offsetHeight+h[0].offsetHeight+h[0].offsetWidth,i.poll.size.n!==i.poll.size.o)?(i.poll.size.o=i.poll.size.n,void g(1)):!j.advanced.updateOnImageLoad||"auto"===j.advanced.updateOnImageLoad&&"y"===j.axis||(i.poll.img.n=m.find("img").length,i.poll.img.n===i.poll.img.o)?void((j.advanced.updateOnSelectorChange||j.advanced.updateOnContentResize||j.advanced.updateOnImageLoad)&&c()):(i.poll.img.o=i.poll.img.n,void m.find("img").each(function(){e(this)}))},j.advanced.autoUpdateTimeout))}function e(b){function c(a,b){return function(){return b.apply(a,arguments)}}function d(){this.onload=null,a(b).addClass(k[2]),g(2)}if(a(b).hasClass(k[2]))return void g();var e=new Image;e.onload=c(e,d),e.src=b.src}function f(){j.advanced.updateOnSelectorChange===!0&&(j.advanced.updateOnSelectorChange="*");var a=0,b=m.find(j.advanced.updateOnSelectorChange);return j.advanced.updateOnSelectorChange&&b.length>0&&b.each(function(){a+=this.offsetHeight+this.offsetWidth}),a}function g(a){clearTimeout(m[0].autoUpdate),l.update.call(null,h[0],a)}var h=a(this),i=h.data(d),j=i.opt,m=a("#mCSB_"+i.idx+"_container");return b?(clearTimeout(m[0].autoUpdate),void Z(m[0],"autoUpdate")):void c()},T=function(a,b,c){return Math.round(a/b)*b-c},U=function(b){var c=b.data(d),e=a("#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal");e.each(function(){Y.call(this)})},V=function(b,c,e){function f(a){return i&&j.callbacks[a]&&"function"==typeof j.callbacks[a]}function g(){return[j.callbacks.alwaysTriggerOffsets||u>=v[0]+y,j.callbacks.alwaysTriggerOffsets||-z>=u]}function h(){var a=[n[0].offsetTop,n[0].offsetLeft],c=[s[0].offsetTop,s[0].offsetLeft],d=[n.outerHeight(!1),n.outerWidth(!1)],f=[m.height(),m.width()];b[0].mcs={content:n,top:a[0],left:a[1],draggerTop:c[0],draggerLeft:c[1],topPct:Math.round(100*Math.abs(a[0])/(Math.abs(d[0])-f[0])),leftPct:Math.round(100*Math.abs(a[1])/(Math.abs(d[1])-f[1])),direction:e.dir}}var i=b.data(d),j=i.opt,k={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:j.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},e=a.extend(k,e),l=[e.dur,e.drag?0:e.dur],m=a("#mCSB_"+i.idx),n=a("#mCSB_"+i.idx+"_container"),o=n.parent(),p=j.callbacks.onTotalScrollOffset?Q.call(b,j.callbacks.onTotalScrollOffset):[0,0],q=j.callbacks.onTotalScrollBackOffset?Q.call(b,j.callbacks.onTotalScrollBackOffset):[0,0];if(i.trigger=e.trigger,(0!==o.scrollTop()||0!==o.scrollLeft())&&(a(".mCSB_"+i.idx+"_scrollbar").css("visibility","visible"),o.scrollTop(0).scrollLeft(0)),"_resetY"!==c||i.contentReset.y||(f("onOverflowYNone")&&j.callbacks.onOverflowYNone.call(b[0]),i.contentReset.y=1),"_resetX"!==c||i.contentReset.x||(f("onOverflowXNone")&&j.callbacks.onOverflowXNone.call(b[0]),i.contentReset.x=1),"_resetY"!==c&&"_resetX"!==c){if(!i.contentReset.y&&b[0].mcs||!i.overflowed[0]||(f("onOverflowY")&&j.callbacks.onOverflowY.call(b[0]),i.contentReset.x=null),!i.contentReset.x&&b[0].mcs||!i.overflowed[1]||(f("onOverflowX")&&j.callbacks.onOverflowX.call(b[0]),i.contentReset.x=null),j.snapAmount){var r=j.snapAmount instanceof Array?"x"===e.dir?j.snapAmount[1]:j.snapAmount[0]:j.snapAmount;c=T(c,r,j.snapOffset)}switch(e.dir){case"x":var s=a("#mCSB_"+i.idx+"_dragger_horizontal"),t="left",u=n[0].offsetLeft,v=[m.width()-n.outerWidth(!1),s.parent().width()-s.width()],w=[c,0===c?0:c/i.scrollRatio.x],y=p[1],z=q[1],A=y>0?y/i.scrollRatio.x:0,B=z>0?z/i.scrollRatio.x:0;break;case"y":var s=a("#mCSB_"+i.idx+"_dragger_vertical"),t="top",u=n[0].offsetTop,v=[m.height()-n.outerHeight(!1),s.parent().height()-s.height()],w=[c,0===c?0:c/i.scrollRatio.y],y=p[0],z=q[0],A=y>0?y/i.scrollRatio.y:0,B=z>0?z/i.scrollRatio.y:0}w[1]<0||0===w[0]&&0===w[1]?w=[0,0]:w[1]>=v[1]?w=[v[0],v[1]]:w[0]=-w[0],b[0].mcs||(h(),f("onInit")&&j.callbacks.onInit.call(b[0])),clearTimeout(n[0].onCompleteTimeout),W(s[0],t,Math.round(w[1]),l[1],e.scrollEasing),(i.tweenRunning||!(0===u&&w[0]>=0||u===v[0]&&w[0]<=v[0]))&&W(n[0],t,Math.round(w[0]),l[0],e.scrollEasing,e.overwrite,{onStart:function(){e.callbacks&&e.onStart&&!i.tweenRunning&&(f("onScrollStart")&&(h(),j.callbacks.onScrollStart.call(b[0])),i.tweenRunning=!0,x(s),i.cbOffsets=g())},onUpdate:function(){e.callbacks&&e.onUpdate&&f("whileScrolling")&&(h(),j.callbacks.whileScrolling.call(b[0]))},onComplete:function(){if(e.callbacks&&e.onComplete){"yx"===j.axis&&clearTimeout(n[0].onCompleteTimeout);var a=n[0].idleTimer||0;n[0].onCompleteTimeout=setTimeout(function(){f("onScroll")&&(h(),j.callbacks.onScroll.call(b[0])),f("onTotalScroll")&&w[1]>=v[1]-A&&i.cbOffsets[0]&&(h(),j.callbacks.onTotalScroll.call(b[0])),f("onTotalScrollBack")&&w[1]<=B&&i.cbOffsets[1]&&(h(),j.callbacks.onTotalScrollBack.call(b[0])),i.tweenRunning=!1,n[0].idleTimer=0,x(s,"hide")},a)}}})}},W=function(a,b,c,d,e,f,g){function h(){v.stop||(s||o.call(),s=X()-r,i(),s>=v.time&&(v.time=s>v.time?s+m-(s-v.time):s+m-1,v.time<s+1&&(v.time=s+1)),v.time<d?v.id=n(h):q.call())}function i(){d>0?(v.currVal=l(v.time,t,w,d,e),u[b]=Math.round(v.currVal)+"px"):u[b]=c+"px",p.call()}function j(){m=1e3/60,v.time=s+m,n=window.requestAnimationFrame?window.requestAnimationFrame:function(a){return i(),setTimeout(a,.01)},v.id=n(h)}function k(){null!=v.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(v.id):clearTimeout(v.id),v.id=null)}function l(a,b,c,d,e){switch(e){case"linear":case"mcsLinear":return c*a/d+b;case"mcsLinearOut":return a/=d,a--,c*Math.sqrt(1-a*a)+b;case"easeInOutSmooth":return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b);case"easeInOutStrong":return a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(-Math.pow(2,-10*a)+2)+b);case"easeInOut":case"mcsEaseInOut":return a/=d/2,1>a?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b);case"easeOutSmooth":return a/=d,a--,-c*(a*a*a*a-1)+b;case"easeOutStrong":return c*(-Math.pow(2,-10*a/d)+1)+b;case"easeOut":case"mcsEaseOut":default:var f=(a/=d)*a,g=f*a;return b+c*(.499999999999997*g*f+-2.5*f*f+5.5*g+-6.5*f+4*a)}}a._mTween||(a._mTween={top:{},left:{}});var m,n,g=g||{},o=g.onStart||function(){},p=g.onUpdate||function(){},q=g.onComplete||function(){},r=X(),s=0,t=a.offsetTop,u=a.style,v=a._mTween[b];"left"===b&&(t=a.offsetLeft);var w=c-t;v.stop=0,"none"!==f&&k(),j()},X=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Y=function(){var a=this;a._mTween||(a._mTween={top:{},left:{}});for(var b=["top","left"],c=0;c<b.length;c++){var d=b[c];a._mTween[d].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(a._mTween[d].id):clearTimeout(a._mTween[d].id),a._mTween[d].id=null,a._mTween[d].stop=1)}},Z=function(a,b){try{delete a[b]}catch(c){a[b]=null}},$=function(a){return!(a.which&&1!==a.which)},_=function(a){var b=a.originalEvent.pointerType;return!(b&&"touch"!==b&&2!==b)},aa=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},ba=function(a){var b=a.parents(".mCSB_container");return[a.offset().top-b.offset().top,a.offset().left-b.offset().left]},ca=function(){function a(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)if(a[b]+"Hidden"in document)return a[b]+"Hidden";return null}var b=a();return b?document[b]:!1};a.fn[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c]=function(b){return l[b]?l[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):l.init.apply(this,arguments)},a[c].defaults=f,window[c]=!0,a(window).load(function(){a(e)[c](),a.extend(a.expr[":"],{mcsInView:a.expr[":"].mcsInView||function(b){var c,d,e=a(b),f=e.parents(".mCSB_container");if(f.length)return c=f.parent(),d=[f[0].offsetTop,f[0].offsetLeft],d[0]+ba(e)[0]>=0&&d[0]+ba(e)[0]<c.height()-e.outerHeight(!1)&&d[1]+ba(e)[1]>=0&&d[1]+ba(e)[1]<c.width()-e.outerWidth(!1)},mcsOverflow:a.expr[":"].mcsOverflow||function(b){var c=a(b).data(d);if(c)return c.overflowed[0]||c.overflowed[1]}})})})}),Dialog.prototype.construct=function(a){var b=this;if(b.isGroup)var c={chat_id:b.id};else var c={user_id:b.id};var d=$("<a/>",{id:"dialog-"+b.id,"class":b.getClass(),href:b.url,html:$("<div/>",{"class":"container",html:[$("<div/>",{"class":"header",html:[$("<i/>",{"class":"icon-ok markAsRead"}),$("<i/>",{"class":"icon-chat history slide","data-target":"#history"}),$("<div/>",{"class":"photo"}),$("<div/>",{"class":"name",html:[$("<span/>",{"class":"title"}),,$("<span/>",{"class":"date",html:new Date(1e3*b.date).toStringVkFormat()})]})]}),$("<div/>",{"class":"mess-container"}),$("<div/>",{"class":"ans",html:$("<textarea/>")})]})}).data({answer:c,markAsRead:{peer_id:b.id,start_message_id:b.messages[0].id},url:b.url,hash:b.hash()});return d.find(".photo").html(function(){if(b.photo_50)return(new User).ava({size:50,src:b.photo_50});if(!b.isGroup||!$.isArray(b.chat_active))return a[b.user_id].ava({size:50});switch(b.chat_active=b.chat_active.slice(0,4),b.chat_active.length){case 1:return a[b.chat_active[0]].ava({size:50});case 2:return[a[b.chat_active[0]].ava({size:50,type:"half"}),a[b.chat_active[1]].ava({size:50,type:"half"})];case 3:return[a[b.chat_active[0]].ava({size:50,type:"half"}),a[b.chat_active[1]].ava({size:23,type:"quarter"}),a[b.chat_active[2]].ava({size:23,type:"quarter"})];case 4:return[a[b.chat_active[0]].ava({size:23,type:"quarter"}),a[b.chat_active[1]].ava({size:23,type:"quarter"}),a[b.chat_active[2]].ava({size:23,type:"quarter"}),a[b.chat_active[3]].ava({size:23,type:"quarter"})]}}),d.find(".name").text(function(){return b.isGroup?b.title:a[b.user_id].name}),d.find(".mess-container").html(b.constructMessages(a)),d},Dialog.prototype.constructMessages=function(a){var b=[],c=this;return $.each(c.messages,function(d,e){e=new Message(e,c.url),c.isGroup||1===c.out?b.push(e.getHtml(a,"compact")):b=b.concat(e.getHtml())}),b},Dialog.prototype.getClass=function(a){var b=(a?a+" ":"")+"dialog";return this.unread&&(b+=" dialog-unread"),1===this.out&&(b+=" dialog-answer",0===this.read_state&&(b+=" dialog-answer-unread")),this.isGroup&&(b+=" dialog-group"),b},Dialog.prototype.hash=function(){return this.messages.reduce(function(a,b){return a+b.id},this.id-0)},!window.Emoji)var Emoji={emojiCharSeq:/[0-9\uD83D\uD83C]/,emojiRegEx:/((?:[\uE000-\uF8FF\u270A-\u2764\u2122\u231B\u25C0\u25FB-\u25FE\u2615\u263a\u2648-\u2653\u2660-\u2668\u267B\u267F\u2693\u261d\u26A0-\u26FA\u2708\u2702\u2601\u260E]|[\u2600\u26C4\u26BE\u23F3\u2705\u2764]|[\uD83D\uD83C][\uDC00-\uDFFF]|\uD83C[\uDDE6-\uDDFF]\uD83C[\uDDE6-\uDDFF]|[0-9]\u20e3|[\u200C\u200D])+)/g,pathToEmojisImages:"https://vk.com/images/emoji/",getEmojiHTML:function(a,b){return'<img class="emoji" '+(b?'alt="'+b+'"':"")+' src="'+this.pathToEmojisImages+a+'.png" />';
},emojiToHTML:function(a){a=a.replace(/&nbsp;/g," ").replace(/<br>/g,"\n");var b={D83DDE07:/(\s|^)([0OО]:\))([\s\.,]|$)/g,D83DDE09:/(\s|^)(;-\)+)([\s\.,]|$)/g,D83DDE06:/(\s|^)([XХxх]-?D)([\s\.,]|$)/g,D83DDE0E:/(\s|^)(B-\))([\s\.,]|$)/g,D83DDE0C:/(\s|^)(3-\))([\s\.,]|$)/g,D83DDE20:/(\s|^)(&gt;\()([\s\.,]|$)/g,D83DDE30:/(\s|^)(;[oоOО])([\s\.,]|$)/g,D83DDE33:/(\s|^)(8\|)([\s\.,]|$)/g,D83DDE32:/(\s|^)(8-?[oоOО])([\s\.,]|$)/g,D83DDE0D:/(\s|^)(8-\))([\s\.,]|$)/g,D83DDE37:/(\s|^)(:[XХ])([\s\.,]|$)/g,D83DDE28:/(\s|^)(:[oоOО])([\s\.,]|$)/g,2764:/(\s|^)(&lt;3)([\s\.,]|$)/g};for(var c in b)a=a.replace(b[c],function(a,b,d,e){return(b||"")+Emoji.getEmojiHTML(c)+(e||"")});var b={D83DDE0A:/(:-\))([\s\.,]|$)/g,D83DDE03:/(:-D)([\s\.,]|$)/g,D83DDE1C:/(;-[PР])([\s\.,]|$)/g,D83DDE0B:/(:-[pр])([\s\.,]|$)/g,D83DDE12:/(:-\()([\s\.,]|$)/g,"263A":/(:-?\])([\s\.,]|$)/g,D83DDE0F:/(;-\])([\s\.,]|$)/g,D83DDE14:/(3-?\()([\s\.,]|$)/g,D83DDE22:/(:&#039;\()([\s\.,]|$)/g,D83DDE2D:/(:_\()([\s\.,]|$)/g,D83DDE29:/(:\(\()([\s\.,]|$)/g,D83DDE10:/(:\|)([\s\.,]|$)/g,D83DDE21:/(&gt;\(\()([\s\.,]|$)/g,D83DDE1A:/(:-\*)([\s\.,]|$)/g,D83DDE08:/(\}:\))([\s\.,]|$)/g,D83DDC4D:/(:like:)([\s\.,]|$)/g,D83DDC4E:/(:dislike:)([\s\.,]|$)/g,"261D":/(:up:)([\s\.,]|$)/g,"270C":/(:v:)([\s\.,]|$)/g,D83DDC4C:/(:ok:|:ок:)([\s\.,]|$)/g};for(var c in b)a=a.replace(b[c],function(a,b,d){return Emoji.getEmojiHTML(c)+(d||"")});return a=a.replace(/\n/g,"<br>"),a=a.replace(Emoji.emojiRegEx,Emoji.emojiReplace).replace(/\uFE0F/g,"")},emojiReplace:function(a){for(var b,c=0,d="",e="",f=[],g=[];b=a.charCodeAt(c++);){var h=b.toString(16).toUpperCase(),i=a.charAt(c-1);2!=c||8419!=b?(d+=h,e+=i,i.match(Emoji.emojiCharSeq)||(g.push(d),f.push(e),d="",e="")):(g.push("003"+a.charAt(0)+"20E3"),f.push(a.charAt(0)),d="",e="")}d&&(g.push(d),f.push(e));var j="",d="",e="",k=!1,l=!1;for(var c in g){var h=g[c],i=f[c];if(i.match(/\uD83C[\uDFFB-\uDFFF]/))d+=h,e+=i;else if(k)d+=h,e+=i,k=!1;else{if("200C"==h||"200D"==h){if(d){k=!0;continue}j+=i}if(i.match(/\uD83C[\uDDE6-\uDDFF]/)){if(l){d+=h,e+=i,l=!1;continue}l=!0}else l&&(l=!1);d&&(j+=Emoji.getEmojiHTML(d,e,!0)),d=h,e=i}}return d&&(j+=Emoji.getEmojiHTML(d,e,!0)),j}};String.prototype.escapeHtml=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return this.replace(/[&<>"']/g,function(b){return a[b]})},String.prototype.link=function(a,b){if(a||(a="http://vk.com/"),b){var c,d="";for(c in b)d+=c+'="'+b[c]+'"'}else var d="";return'<a href="'+a+'" target="_blank" '+d+">"+this+"</a>"},String.prototype.icon=function(a,b){if(b){var c,d="";for(c in b)"class"===c?a+=" "+b["class"]:d+=c+'="'+b[c]+'"'}else var d="";return'<i class="icon-'+a+'" '+d+"></i>"+this},Date.prototype.toStringVkFormat=function(){var a=new Date,b=(a.getTime()-this.getTime())/1e3;if(10>b)return window.Popup.loc("just now");if(60>b)return getCase(Math.floor(b),window.Popup.loc("seconds"))+"&nbsp"+window.Popup.loc("ago");if(3600>b)return getCase(Math.floor(b/60),window.Popup.loc("minutes"))+"&nbsp"+window.Popup.loc("ago");if(10800>b)return getCase(Math.floor(b/3600),window.Popup.loc("hours"))+"&nbsp"+window.Popup.loc("ago");var c=this.getHours()<10?"0"+this.getHours():this.getHours(),d=this.getMinutes()<10?"0"+this.getMinutes():this.getMinutes();if(86400>b)return window.Popup.loc("today")+"&nbsp"+window.Popup.loc("at")+"&nbsp"+c+":"+d;if(172800>b)return window.Popup.loc("tomorrow")+"&nbsp"+window.Popup.loc("at")+"&nbsp"+c+":"+d;var e=this.getFullYear()!=a.getFullYear()?"&nbsp"+this.getFullYear():"";return this.getDate()+"&nbsp"+window.Popup.loc("months")[this.getMonth()]+e+"&nbsp"+window.Popup.loc("at")+"&nbsp"+c+":"+d},Message.prototype.getHtml=function(a,b){switch(b){case"compact":return $("<message/>",{html:[a[this.user_id].ava({size:25,title:!0,marker:!1})].concat(this.body)});default:return this.body}};var Popup={load:function(a){var b=$.Deferred();return chrome.storage.local.get(a,function(a){b.resolve(a)}),b.promise()},initScroll:function(){return $("#newmess, #newfriends, #history").mCustomScrollbar({axis:"y",autoHideScrollbar:!0,alwaysShowScrollbar:0,contentTouchScroll:!1,theme:"dark-thin",scrollbarPosition:"inside",scrollInertia:150,keyboard:{enable:!1},mouseWheel:{scrollAmount:61},callbacks:{onScroll:function(){$(this).trigger("scrollEnd")}}}),$("#newmess .mCSB_container").attr("data-before",this.loc("Your private messages will be displayed here.")),this},loadTranslate:function(){var a=$.Deferred(),b=this;return $.when($.getJSON("../lang/i18n.json"),b.load("lang")).then(function(c,d){b.i18n=c[0],b.lang=d.lang,a.resolve()},function(b,c){console.error("3. Load translate failed",b,c),a.reject(3)}),a.promise()},setTranslate:function(){var a=this;return $("#menu li .i18n, .navbar-brand, .dropdown li a").text(function(b,c){return a.loc(c,!1)}),$("#newmess, #newfriends").attr("data-before",function(b,c){return a.loc(c,!1)}),this},loadProfiles:function(){var a=$.Deferred(),b=this;return b.profiles||(b.profiles={}),b.load("profiles").done(function(c){!$.isArray(c.profiles)||$.isEmptyObject(c.profiles)?a.reject():($.each(c.profiles,function(a,c){b.profiles[c.id]||(b.profiles[c.id]=c)}),a.resolve())}),a.promise()},u:function(a){var b=$.Deferred(),c=this,d={},e=[];return $.isArray(a)||(a=[a]),$.each(a,function(a,b){b&&!d[b]&&(c.profiles[b]?d[b]=new User(c.profiles[b]):(d[b]=new User,e.push(b)))}),e.length>0?(console.warn("Undefined users:",e),(new Vk).api("users.get",{fields:"status,photo_100,domain,online",user_ids:e}).then(function(a){$.each(a,function(a,b){c.profiles[b.id]=b,d[b.id]=new User(b)}),b.resolve(d)},function(){console.error("4. Users not loaded",e),b.reject(d)})):b.resolve(d),b.promise()},initSlide:function(){$(document).on("click",".slide",function(){var a=$(this).attr("data-target");return a==="#"+$(".slider.open").attr("id")&&(a="#friends-online"),$(".slider.open").add(".slide.open").add(this).add(a).toggleClass("open"),!1});var a=$("#newmess .dialog-unread");return a.length>0&&($("#messages .slide").trigger("click"),1===a.length&&a.trigger("click")),this},buildCounters:function(){var a=this,b=function(){return a.load(["counter","showMessage","dialogs"]).done(function(a){$("#menu .counter").text(function(){var b=$(this).parents("li").attr("id");return a.counter[b]?("messages"===b&&a.showMessage&&(a.counter.messages=0,$.each(a.dialogs,function(b,c){c.unread&&(a.counter.messages+=c.unread)})),"+"+Math.min(a.counter[b],99)):"messages"===b?"+":""})})};return chrome.storage.onChanged.addListener(function(a){(a.counter||a.showMessage||a.dialogs)&&b()}),b()},show:function(){return $(".wraper").remove(),this},setCurrentProfile:function(){var a=$.Deferred(),b=this;return b.load("user_id").done(function(c){b.u(c.user_id).always(function(d){b.current=d[c.user_id],$("#my a.profile").attr("href","https://vk.com/"+b.current.domain),$("header .profile").html([b.current.online?'<i class="mark"></i>':"",b.current.name,b.current.ava({isLink:!1,marker:!1,size:32})]),a.resolve()})}),a.promise()},builFriendsOnline:function(){var a=$.Deferred(),b=this;return b.load("friends").done(function(c){$.isEmptyObject(c.friends)?a.resolve():b.u(c.friends).always(function(b){var d=[];$.each(c.friends,function(a,c){d.push($("<a/>",{href:"https://vk.com/im?sel="+c,target:"_blank","class":"ava-container",html:[b[c].ava({marker:!1}),$("<div/>",{"class":"ava-caption",html:$("<span/>",{"class":"name",html:[$("<i/>",{"class":"icon-pencil"}),b[c].name]})})]}).data("user_id",c))}),$("#friends-online").html(d).on("click",".ava-container",function(){var a=$(this).data("user_id");return $("#newmess .dialog").is("#dialog-"+a)?($("#messages .slide").trigger("click"),$("#newmess #dialog-"+a).trigger("click"),!1):void 0}),a.resolve()})}),a.promise()},buildNewFriends:function(){var a=$.Deferred(),b=this;return b.load("newfriends").done(function(c){if($.isEmptyObject(c.newfriends))a.resolve();else{var d=[];b.u(c.newfriends).always(function(e){$.each(c.newfriends,function(a,c){var f=e[c].status.escapeHtml();d.push($("<figure/>",{html:[$("<i/>",{"class":"icon-cancel hovered",title:b.loc("Reject")}),$("<i/>",{"class":"icon-ok hovered",title:b.loc("Accept")}),e[c].ava({isLink:!0,size:50}),$("<figcaption/>",{html:[e[c].profileLink(),$("<span/>",{html:f.length>60?f.substr(0,60)+"…":f})]})]}).data("user_id",c))}),a.resolve(),$("#newfriends").html(d).on("click",".hovered",function(){$button=$(this).addClass("icon-spin4 animate-spin"),(new Vk).load().done(function(a){if($button.hasClass("icon-ok"))var b="friends.add";else var b="friends.delete";$user=$button.parents("figure"),a.api(b,$user.data()).done(function(){$user.slideUp("fast")}).always(function(){$button.removeClass("icon-spin4 animate-spin")})})})})}}),a.promise()},buildDialogs:function(){var a=$.Deferred(),b=this;return b.load(["dialogs","options","user_id"]).done(function(c){if(c.dialogs.length>0){var d=[c.user_id];$.each(c.dialogs,function(a,b){b.chat_active&&(d=d.concat(b.chat_active),d.push(b.admin_id)),d.push(b.user_id)}),b.u(d).always(function(d){var e=$("#newmess"),f=[];$.each(c.dialogs,function(a,b){f.unshift(new Dialog(b).construct(d))}),a.resolve(),e.html(f).on("click",".dialog",function(a){var b=$(this);return b.find("a, textarea, .history, .markAsRead").is(a.target)?!0:void(b.hasClass("open")?b.removeClass("open").find(".ans").slideUp("fast"):(e.find(".dialog.open").removeClass("open").find(".ans").slideUp("fast"),b.addClass("open").find(".ans").slideDown("fast",function(){b.offset().top-53>0?(e.one("scrollEnd",function(){b.find("textarea").trigger("focus")}),e.mCustomScrollbar("scrollTo",b)):b.find("textarea").trigger("focus")})))}).on("keypress","textarea",function(a){if(13===a.keyCode&&!a.ctrlKey&&!a.shiftKey){if(this.value){var b=$(this).attr("disabled","disabled");(new Vk).load().done(function(a){var c=b.parents(".dialog"),e=c.data("answer");e.message=b.val().trim(),a.api("messages.send",e).done(function(f){b.removeClass("error").val(""),c.removeClass("dialog-unread").addClass("dialog-answer dialog-answer-unread").find(".mess-container").html(new Message({id:f,user_id:a.user_id,out:1,body:e.message}).getHtml(d,"compact"))}).fail(function(){b.addClass("error")}).always(function(){b.removeAttr("disabled").trigger("focus")})})}return!1}});var g=function(){var a=$(this),c=a.hasClass("more");if(c)var d=a.data(),e=d.peer,f=d.url,g=d.start_message_id;else{var d=a.parents(".dialog").data(),e=d.answer,f=d.url;$("#history .mCSB_container").empty()}g&&(e.start_message_id=g),(new Vk).load().done(function(d){d.api("messages.getHistory",e).done(function(h){var i=[],j=[d.user_id];$.each(h.items,function(a,b){j.push(b.from_id)}),b.u(j).always(function(d){$.each(h.items,function(a,b){i.push(new Message(b,f).getHtml(d,"compact").addClass("dialog"))}),g=h.items[h.items.length-1].id,c?(i.shift(),a.before(i).data("start_message_id",g),h.items.length<20&&a.remove()):20==h.items.length&&(i.push($("<a/>",{"class":"dialog history more",text:b.loc("More")}).data({url:f,peer:e,start_message_id:g})),$("#history .mCSB_container").html(i))})})})};e.on("click",".history",g),$("#history").on("click",".history",g),chrome.storage.onChanged.addListener(function(a){a.dialogs&&!$.isEmptyObject(a.dialogs.newValue)&&$.each(a.dialogs.newValue,function(a,b){b=new Dialog(b);var c=$("#dialog-"+b.id);if(c.length>0&&c.data("hash")!=b.hash()){var e=c.hasClass("open");c.removeAttr("class").addClass(b.getClass(e?"open":"")).find(".mess-container").html(b.constructMessages(d))}})})})}else a.resolve()}),a.promise()},checkError:function(){var a=$.Deferred(),b=this;return b.load(["alert_message","alert_error"]).done(function(c){c.alert_error?(b.buildAlert(c.alert_error).addClass("error"),a.reject(c.alert_error.code)):(c.alert_message&&b.buildAlert(c.alert_message).on("click","a[href]",function(){chrome.storage.local.remove(["alert_message"])}),a.resolve())}),a.promise()},buildAlert:function(a){var b=$("#alert");if(b.hasClass("show"))return b;var c,d=$("<thead/>",{html:"<tr><td>"+(a.header?this.loc(a.header):"")+"</td></tr>"});a.footer&&(c=$("<tfoot/>",{html:'<tr><td><a href="#">'+(a.footer?this.loc(a.footer):"")+"</a></td></tr>"}));var e=[];return a.body&&(a.body.img&&e.push($("<a/>",{"class":"img",target:"_blank",href:a.body.url,html:$("<img/>",{src:a.body.img})})),a.body.text&&e.push($("<a/>",{"class":"text",target:"_blank",href:a.body.url,html:this.loc(a.body.text)})),a.body.ancor&&e.push($("<a/>",{"class":"ancor",target:"_blank",href:a.body.url,html:this.loc(a.body.ancor)})),e=$("<tbody/>",{html:$("<tr/>",{html:$("<td/>",{html:e})})})),b.addClass("show").find("table").html([d,e,c]),b},loc:function(a,b){if(!a)return"";if(b===!1)var c=void 0;else var c=a;return this.i18n&&this.i18n[a]&&this.i18n[a][this.lang]?this.i18n[a][this.lang]:c}};User.prototype.domain="https://vk.com/",User.prototype.first_name="",User.prototype.last_name="",User.prototype.name="",User.prototype.photo_100="img/camera_100.png",User.prototype.status="",User.prototype.profileLink=function(a){return $("<a/>",{href:"https://vk.com/"+this.domain,target:"_blank","class":"profile",html:a||this.name})},User.prototype.ava=function(a){a=$.extend({title:!1,isLink:!1,size:100,marker:!0,src:this.photo_100,type:"full"},a);var b=$("<div/>",{"class":"ava ava-"+a.type+(this.online&&a.marker?" online":""),html:$("<img/>",{title:a.title?this.name:"",src:a.src,width:a.size,height:a.size})});return a.isLink===!0?this.profileLink(b):b},$.when(Popup.loadTranslate(),Popup.checkError(),Popup.loadProfiles()).done(function(){$.when(Popup.setCurrentProfile(),Popup.builFriendsOnline(),Popup.buildCounters(),Popup.buildDialogs(),Popup.buildNewFriends()).done(function(){Popup.setTranslate().show().initScroll().initSlide(),$(".dropdown").on("click",function(){$(this).toggleClass("open")});var a=new App;$(".review").attr("href",a.comment),$(".settings").attr("href","chrome-extension://"+a.id+"/options/index.html"),$(".share").attr("href",a.share),$(".logout").on("click",function(){return chrome.storage.local.remove(["user_id","access_token"]),!1}),a.addVisitor()})}).fail(function(a){3===a&&Popup.buildAlert({code:3,header:"Error",body:{text:"3. Load translate failed"}}).addClass("error")}).always(function(){var a=new Vk;$("#alert").on("click",'a[href="'+a.authUrl+'"]',function(){return a.auth(),!1}).on("click","a[href]",function(){$("#alert").removeClass("show")})});