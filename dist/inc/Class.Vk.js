function Vk(){}Vk.prototype.v="5.40",Vk.prototype.authUrl="https://oauth.vk.com/authorize?"+$.param({redirect_uri:"https://oauth.vk.com/blank.html",client_id:4682781,scope:"offline,friends,messages,notifications,wall",response_type:"token",display:"popup",v:Vk.prototype.v,state:"vknotice"}),Vk.prototype.auth=function(){var a=$.Deferred(),b=this;return chrome.windows.create({url:this.authUrl,focused:!0,type:"popup"},function(c){var d=function(a){a.user_id&&(b.user_id=a.user_id.newValue),a.access_token&&(b.access_token=a.access_token.newValue,chrome.windows.remove(c.id))},e=function(f){f===c.id&&(b.access_token&&b.user_id?a.resolve():a.reject(),chrome.storage.onChanged.removeListener(d),chrome.windows.onRemoved.removeListener(e))};chrome.storage.onChanged.addListener(d),chrome.windows.onRemoved.addListener(e)}),a.promise()},Vk.prototype.load=function(){var a=$.Deferred(),b=this;return chrome.storage.local.get(["access_token","user_id"],function(c){b.user_id=c.user_id,b.access_token=c.access_token,b.access_token&&b.user_id?a.resolve(b):b.auth().then(function(){a.resolve(b)},function(){console.error("0. Can't find access_token or user_id"),a.reject(0)})}),a.promise()},Vk.prototype.api=function(a,b){var c=$.Deferred(),d={};return $.isEmptyObject(b)||$.extend(d,b),d.v=this.v,this.access_token&&(d.access_token=this.access_token),$.getJSON("https://api.vk.com/method/"+a,d).done(function(b){b.response?c.resolve(b.response):(console.error("2/"+b.error.error_code+". "+a+". "+b.error.error_msg),c.reject(2,b.error))}).fail(function(a){console.error("1. Connect error"),c.reject(1,a)}),c.promise()};