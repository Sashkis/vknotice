var VkApp;!function(t){var e=function(){function t(t,e,s,r,o,i,n){this.$q=t,this.$http=e,this.storage=s,this.apiConfig=r,this.authConfig=o,this.$log=i,this.stg={},this.authUrl="https://oauth.vk.com/authorize?"+n(o)}return t.prototype.isAuth=function(){var t=this,e=this.$q.defer();return this.stg.access_token&&this.stg.user_id?this.api("users.get",{access_token:this.stg.access_token}).then(function(s){e.resolve(s&&s[0]&&s[0].id&&s[0].id==t.stg.user_id)},function(){e.resolve(!1)}):e.resolve(!1),e.promise},t.prototype.parseHashParams=function(t){for(var e={},s=t.split("#")[1].split("&"),r=s.length;r--;)if(s[r]){var o=s[r].split("=");e[o[0]]=o[1]}return e},t.prototype.isAuthSuccess=function(t){return void 0===t&&(t={}),t&&t.user_id&&t.access_token&&t.state&&"vknotice"===t.state},t.prototype.auth=function(){var t=this,e=this.$q.defer();return this.storage.ready.then(function(s){t.stg=s,t.isAuth().then(function(s){s?e.resolve():chrome.tabs.create({url:t.authUrl,active:!0},function(s){var r=s.id,o=function(e,s){if(r&&r===e&&s.url&&s.url.indexOf("oauth.vk.com/blank.html")>-1){var i=t.parseHashParams(s.url);if(!t.isAuthSuccess(i))return;t.storage.set({user_id:i.user_id,access_token:i.access_token}),!!r&&chrome.tabs.remove(r),chrome.tabs.onUpdated.removeListener(o)}},i=function(s){r===s&&t.isAuth().then(function(t){e[t?"resolve":"reject"](),chrome.tabs.onRemoved.removeListener(i)})};chrome.tabs.onUpdated.addListener(o),chrome.tabs.onRemoved.addListener(i)})})}),e.promise},t.prototype.api=function(t,e){var s=this;void 0===e&&(e={});var r=this.$q.defer();return e.v=this.apiConfig.version,this.$http.get("https://api.vk.com/method/"+t,{params:e}).then(function(t){s.isResponseSuccess(t.data)?r.resolve(t.data.response):(s.$log.error(t.data.error),r.reject("api_error"))},function(){r.reject("connect_error")}),r.promise},t.prototype.isResponseSuccess=function(t){return!!t.response},t.$inject=["$q","$http","storage","apiConfig","authConfig","$log","$httpParamSerializer"],t}();t.VkService=e}(VkApp||(VkApp={}));var VkApp;!function(t){const e="5.52";angular.module("VkApp",["StorageApp"]).constant("apiConfig",{version:e}).constant("authConfig",{redirect_uri:"https://oauth.vk.com/blank.html",client_id:4682781,scope:"offline,friends,messages,notifications,wall",response_type:"token",display:"popup",v:e,state:"vknotice"}).service("$vk",t.VkService)}(VkApp||(VkApp={}));