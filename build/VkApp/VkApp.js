var VkApp;!function(t){var e=function(){function t(t,e,r,s,o,i){this.$q=t,this.$http=e,this.storage=r,this.apiConfig=s,this.authConfig=o,this.stg={},this.authUrl="https://oauth.vk.com/authorize?"+i(o)}return t.prototype.isAuth=function(){var t=this,e=this.$q.defer();return this.stg.access_token&&this.stg.user_id?this.api("users.get",{access_token:this.stg.access_token}).then(function(r){e.resolve(r&&r[0]&&r[0].id&&r[0].id==t.stg.user_id)},function(){e.resolve(!1)}):e.resolve(!1),e.promise},t.prototype.parseHashParams=function(t){for(var e={},r=t.split("#")[1].split("&"),s=r.length;s--;)if(r[s]){var o=r[s].split("=");e[o[0]]=o[1]}return e},t.prototype.isAuthSuccess=function(t){return void 0===t&&(t={}),t&&t.user_id&&t.access_token&&t.state&&"vknotice"===t.state},t.prototype.auth=function(){var t=this,e=this.$q.defer();return this.storage.ready.then(function(r){t.stg=r,t.isAuth().then(function(r){r?e.resolve():chrome.tabs.create({url:t.authUrl,active:!0},function(r){var s=r.id,o=function(e,r){if(s&&s===e&&r.url&&r.url.indexOf("oauth.vk.com/blank.html")>-1){var i=t.parseHashParams(r.url);if(!t.isAuthSuccess(i))return;t.storage.set({user_id:+i.user_id,access_token:i.access_token}),!!s&&chrome.tabs.remove(s),chrome.tabs.onUpdated.removeListener(o)}},i=function(r){s===r&&t.isAuth().then(function(t){e[t?"resolve":"reject"](),chrome.tabs.onRemoved.removeListener(i)})};chrome.tabs.onUpdated.addListener(o),chrome.tabs.onRemoved.addListener(i)})})}),e.promise},t.prototype.api=function(t,e){var r=this;void 0===e&&(e={});var s=this.$q.defer();return e.v=this.apiConfig.version,this.$http.get("https://api.vk.com/method/"+t,{params:e}).then(function(o){r.isResponseSuccess(o.data)?s.resolve(o.data.response):o.data.error&&6===o.data.error.error_code?(console.warn("Wait to restart"),setTimeout(function(){console.warn("Restart"),r.api(t,e).then(s.resolve,s.reject)},2e3)):(console.error(o.data.error),s.reject("api_error"))},function(){s.reject("connect_error")}),s.promise},t.prototype.isResponseSuccess=function(t){return angular.isDefined(t.response)},t.$inject=["$q","$http","storage","apiConfig","authConfig","$httpParamSerializer"],t}();t.VkService=e}(VkApp||(VkApp={}));var VkApp;!function(t){const e="5.52";angular.module("VkApp",["StorageApp"]).constant("apiConfig",{version:e}).constant("authConfig",{redirect_uri:"https://oauth.vk.com/blank.html",client_id:4682781,scope:"offline,friends,messages,notifications,wall",response_type:"token",display:"popup",v:e,state:"vknotice"}).service("$vk",t.VkService)}(VkApp||(VkApp={}));