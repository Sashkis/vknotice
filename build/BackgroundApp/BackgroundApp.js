function deleteAttachent(e){return e.message.attachments&&delete e.message.attachments,e}angular.module("BgApp",["DeamonApp","angular-google-analytics"]).constant("Config",{profilesLimit:100}).config(["$provide","AnalyticsProvider",function(e,o){e.decorator("$exceptionHandler",["$delegate","$log",function(e,o){return function(n,t){o.warn(n,t),e(n,t)}}]),o.setAccount({tracker:"UA-71609511-3",trackEvent:!0,fields:{cookieName:"vknotice-analitics",cookieDomain:"none"},set:{forceSSL:!0}}).setHybridMobileSupport(!0)}]).run(["Config","storage","$vk","deamon","$log","Analytics",function(e,o,n,t,s,i){function r(e,o){var n=0;angular.forEach(e,function(e){n+=angular.isNumber(e)?e:0}),chrome.browserAction.setBadgeText({text:n>0?""+n:""}),a(n,o)}function a(e,o){"0"!==o&&chrome.browserAction.getBadgeText({},function(n){e>n&&("2"===o?document.getElementById("audio").play():chrome.tabs.query({url:"*://*.vk.com/*"},function(e){e.length||document.getElementById("audio").play()}))})}o.onChanged(function(e,n){e.users&&e.users.newValue&&o.setProfiles(e.users.newValue),e.groups&&e.groups.newValue&&o.setProfiles(e.groups.newValue),e.counter&&e.counter.newValue&&r(e.counter.newValue,n.options.audio),e.user_id&&e.user_id.newValue&&i.set("&uid",e.user_id.newValue);var t={};angular.forEach(e,function(e,o){angular.isDefined(e.newValue)&&(t[o]=angular.copy(e.newValue))}),t.profiles=n.profiles,o.set(t)}),o.ready.then(function(e){angular.isUndefined(e.profiles)&&o.set({profiles:[]}),angular.isUndefined(e.options)&&o.set({options:{friends:!0,photos:!0,videos:!0,messages:!0,groups:!0,notifications:!0,comments:!0,audio:"1"}}),e.users&&o.setProfiles(e.users),e.groups&&o.setProfiles(e.groups),o.clearProfiles(),e.counter&&r(e.counter,e.options.audio),angular.isUndefined(e.lastOpenComment)&&(e.lastOpenComment=Date.now()),i.trackPage("Background"),e.user_id&&i.set("&uid",e.user_id),n.auth().then(function(){var n={access_token:e.access_token,options:"",isLoadComment:e.options.comments,lastOpenComment:e.lastOpenComment};e.options.friends&&(n.options+="friends,"),e.options.photos&&(n.options+="photos,"),e.options.videos&&(n.options+="videos,"),e.options.messages&&(n.options+="messages,"),e.options.groups&&(n.options+="groups,"),e.options.notifications&&(n.options+="notifications,"),t.start("execute.ang",n,function(e){return chrome.browserAction.setIcon({path:"img/icon38.png"}),e.dialogs.map(deleteAttachent),delete e.system,o.set(e),!0},function(e){return chrome.browserAction.setIcon({path:"img/icon38-off.png"}),"connect_error"===e})},function(e){s.error("Auth Error",e)})})}]);